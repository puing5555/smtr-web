<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ í˜¸ ê²€ì¦ ë¦¬ë·° - ì¸í”Œë£¨ì–¸ì„œ ì‹œê·¸ë„ ê²€í† </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
        }

        .pipeline {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pipeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 80px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .step-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .step-desc {
            font-size: 10px;
            color: #7f8c8d;
        }

        .pipeline-arrow {
            font-size: 24px;
            color: #3498db;
            font-weight: bold;
        }

        .verification-stages {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .stage-indicator {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stage-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .stage-complete {
            background: #d4edda;
            color: #155724;
        }

        .stage-warning {
            background: #fff3cd;
            color: #856404;
        }

        .stage-error {
            background: #f8d7da;
            color: #721c24;
        }

        .stage-missing {
            background: #f8d7da;
            color: #721c24;
        }

        .stage-skip {
            background: #e2e3e5;
            color: #495057;
        }

        .stage-na {
            background: #fff3cd;
            color: #856404;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .controls label {
            font-weight: bold;
            margin-right: 8px;
        }

        .controls select, .controls button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .controls button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .controls button:hover {
            background: #2980b9;
        }

        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .signal-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            overflow: hidden;
            border-left: 4px solid #3498db;
        }

        .signal-card.suspicious {
            border-left-color: #f39c12;
        }

        .signal-card.rejected {
            border-left-color: #e74c3c;
        }

        .signal-card.approved {
            border-left-color: #27ae60;
        }

        .signal-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .signal-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-info {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 14px;
            color: #666;
        }

        .signal-body {
            padding: 20px;
        }

        .original-signal, .gpt-verification, .human-review {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .human-review {
            border-bottom: none;
        }

        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .signal-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .detail-label {
            font-weight: bold;
            color: #555;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .signal-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .signal-BUY { background: #d4edda; color: #155724; }
        .signal-SELL { background: #f8d7da; color: #721c24; }
        .signal-STRONG_SELL { background: #f5c6cb; color: #721c24; }
        .signal-POSITIVE { background: #d1ecf1; color: #0c5460; }
        .signal-CONCERN { background: #fff3cd; color: #856404; }

        .verification-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 3px solid #28a745;
        }

        .verification-result.error {
            border-left-color: #dc3545;
        }

        .review-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
        }

        .action-btn.approve {
            background: #27ae60;
            color: white;
        }

        .action-btn.reject {
            background: #e74c3c;
            color: white;
        }

        .action-btn.modify {
            background: #f39c12;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .review-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-modified { background: #fff3cd; color: #856404; }
        .status-pending { background: #e2e3e5; color: #495057; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .signal-details {
                grid-template-columns: 1fr;
            }
            
            .review-actions {
                flex-direction: column;
            }
            
            .pipeline {
                flex-direction: column;
                gap: 8px;
            }
            
            .pipeline-arrow {
                transform: rotate(90deg);
            }
            
            .stats {
                justify-content: center;
            }
            
            .stage-indicator {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ì‹ í˜¸ ê²€ì¦ ë¦¬ë·° ì‹œìŠ¤í…œ</h1>
            <p>ì¸í”Œë£¨ì–¸ì„œ ì‹œê·¸ë„ì˜ 3ë‹¨ê³„ ê²€ì¦ ê²°ê³¼ë¥¼ ì‚¬ëŒì´ ìµœì¢… ê²€í† í•©ë‹ˆë‹¤.</p>
            
            <!-- Pipeline Visualization -->
            <div class="pipeline">
                <div class="pipeline-step">
                    <div class="step-number">1</div>
                    <div class="step-title">GPT-4o-mini</div>
                    <div class="step-desc">ì‹œê·¸ë„ ì¶”ì¶œ</div>
                </div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">
                    <div class="step-number">2</div>
                    <div class="step-title">GPT-4o</div>
                    <div class="step-desc">ì •í™•ë„ ê²€ì¦</div>
                </div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">
                    <div class="step-number">3</div>
                    <div class="step-title">Claude Opus</div>
                    <div class="step-desc">ë…ë¦½ ê²€ì¦</div>
                </div>
                <div class="pipeline-arrow">â†’</div>
                <div class="pipeline-step">
                    <div class="step-number">4</div>
                    <div class="step-title">ì‚¬ëŒ</div>
                    <div class="step-desc">ìµœì¢… ìŠ¹ì¸</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div>
                <label for="filterStatus">í•„í„°:</label>
                <select id="filterStatus">
                    <option value="all">ì „ì²´ ë³´ê¸°</option>
                    <option value="suspicious">GPT ì˜ì‹¬ë§Œ ë³´ê¸°</option>
                    <option value="claude-suspicious">Claude ì˜ì‹¬ë§Œ ë³´ê¸°</option>
                    <option value="pending">ê²€í†  ëŒ€ê¸°</option>
                    <option value="approved">ìŠ¹ì¸ë¨</option>
                    <option value="rejected">ê±°ë¶€ë¨</option>
                </select>
            </div>
            
            <div>
                <label for="filterInfluencer">ì¸í”Œë£¨ì–¸ì„œ:</label>
                <select id="filterInfluencer">
                    <option value="all">ì „ì²´</option>
                </select>
            </div>
            
            <button onclick="loadData()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="exportResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="importData()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalSignals">0</div>
                <div class="stat-label">ì´ ì‹œê·¸ë„</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="suspiciousSignals">0</div>
                <div class="stat-label">GPT ì˜ì‹¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="claudeConfirmed">0</div>
                <div class="stat-label">Claude í™•ì¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="claudeSuspicious">0</div>
                <div class="stat-label">Claude ì˜ì‹¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="claudeRejected">0</div>
                <div class="stat-label">Claude ê±°ë¶€</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="reviewedSignals">0</div>
                <div class="stat-label">ê²€í†  ì™„ë£Œ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="approvedSignals">0</div>
                <div class="stat-label">ìŠ¹ì¸ë¨</div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="signalsList">
            <!-- ì‹ í˜¸ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ìˆ¨ê²¨ì§„ input -->
    <input type="file" id="fileInput" accept=".json,.jsonl" style="display: none;" onchange="handleFileImport(event)">

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let signalsData = [];
        let verificationResults = {};
        let claudeResults = {};
        let humanReviews = JSON.parse(localStorage.getItem('signalReviews') || '{}');

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('filterStatus').addEventListener('change', filterAndRenderSignals);
            document.getElementById('filterInfluencer').addEventListener('change', filterAndRenderSignals);
        }

        async function loadData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            try {
                // ì›ë³¸ ì‹ í˜¸ ë°ì´í„° ë¡œë“œ
                const signalsResponse = await fetch('/smtr_data/corinpapa1106/_extracted_signals.json');
                if (!signalsResponse.ok) throw new Error('ì›ë³¸ ì‹ í˜¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                signalsData = await signalsResponse.json();

                // GPT ê²€ì¦ ê²°ê³¼ ë¡œë“œ (JSONL íŒŒì¼)
                try {
                    const verificationResponse = await fetch('/smtr_data/corinpapa1106/_verify_batch_test_result.jsonl');
                    if (verificationResponse.ok) {
                        const verificationText = await verificationResponse.text();
                        parseVerificationResults(verificationText);
                    }
                } catch (e) {
                    console.warn('GPT ê²€ì¦ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', e);
                }

                // Claude ê²€ì¦ ê²°ê³¼ ë¡œë“œ (JSON íŒŒì¼)
                try {
                    const claudeResponse = await fetch('/smtr_data/corinpapa1106/_claude_verify_test_result.json');
                    if (claudeResponse.ok) {
                        const claudeData = await claudeResponse.json();
                        parseClaudeResults(claudeData);
                    }
                } catch (e) {
                    console.warn('Claude ê²€ì¦ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', e);
                }

                populateInfluencerFilter();
                filterAndRenderSignals();
                updateStats();
                
            } catch (error) {
                document.getElementById('error').textContent = `ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`;
                document.getElementById('error').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function parseVerificationResults(jsonlText) {
            const lines = jsonlText.trim().split('\n');
            verificationResults = {};
            
            lines.forEach(line => {
                if (!line.trim()) return;
                try {
                    const batchResult = JSON.parse(line);
                    const videoId = batchResult.custom_id.replace('verify_corinpapa_', '');
                    const verifications = JSON.parse(batchResult.response.body.choices[0].message.content);
                    
                    verificationResults[videoId] = verifications;
                } catch (e) {
                    console.warn('ê²€ì¦ ê²°ê³¼ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            });
        }

        function parseClaudeResults(claudeData) {
            claudeResults = {};
            
            if (claudeData.results) {
                claudeData.results.forEach(result => {
                    const key = `${result.video_id}_${result.signal_index}`;
                    claudeResults[key] = result.claude_verification;
                });
            }
        }

        function populateInfluencerFilter() {
            const influencerSelect = document.getElementById('filterInfluencer');
            const influencers = [...new Set(signalsData.map(signal => signal.influencer))];
            
            influencerSelect.innerHTML = '<option value="all">ì „ì²´</option>';
            influencers.forEach(influencer => {
                const option = document.createElement('option');
                option.value = influencer;
                option.textContent = influencer;
                influencerSelect.appendChild(option);
            });
        }

        function filterAndRenderSignals() {
            const statusFilter = document.getElementById('filterStatus').value;
            const influencerFilter = document.getElementById('filterInfluencer').value;
            
            let filteredSignals = signalsData.map((signal, index) => ({...signal, originalIndex: index}));
            
            // ì¸í”Œë£¨ì–¸ì„œ í•„í„°
            if (influencerFilter !== 'all') {
                filteredSignals = filteredSignals.filter(signal => signal.influencer === influencerFilter);
            }
            
            // ìƒíƒœ í•„í„°
            if (statusFilter !== 'all') {
                filteredSignals = filteredSignals.filter(signal => {
                    const reviewStatus = getReviewStatus(signal);
                    const verification = getVerificationForSignal(signal);
                    
                    switch (statusFilter) {
                        case 'suspicious':
                            return isSuspiciousSignal(signal, verification);
                        case 'claude-suspicious':
                            return hasClaudeSuspicious(signal);
                        case 'pending':
                            return reviewStatus === 'pending';
                        case 'approved':
                            return reviewStatus === 'approved';
                        case 'rejected':
                            return reviewStatus === 'rejected';
                        default:
                            return true;
                    }
                });
            }
            
            renderSignals(filteredSignals);
        }

        function getVerificationForSignal(signal) {
            const videoVerifications = verificationResults[signal.video_id];
            if (!videoVerifications || !videoVerifications.verifications) return null;
            
            return videoVerifications.verifications.find(v => {
                const originalSignal = signalsData[v.signal_index];
                return originalSignal && 
                       originalSignal.video_id === signal.video_id && 
                       originalSignal.stock === signal.stock &&
                       originalSignal.timestamp === signal.timestamp;
            });
        }

        function isSuspiciousSignal(signal, verification) {
            if (!verification) return false;
            return !verification.stock_correct || 
                   !verification.signal_correct || 
                   !verification.quote_correct || 
                   !verification.speaker_correct ||
                   verification.error_type !== null;
        }

        function getClaudeVerification(signal) {
            const signalIndex = signalsData.findIndex(s => 
                s.video_id === signal.video_id && 
                s.stock === signal.stock && 
                s.timestamp === signal.timestamp
            );
            
            const key = `${signal.video_id}_${signalIndex}`;
            return claudeResults[key] || null;
        }

        function hasClaudeSuspicious(signal) {
            const claude = getClaudeVerification(signal);
            return claude && claude.verdict === 'suspicious';
        }

        function getReviewStatus(signal) {
            const key = getSignalKey(signal);
            return humanReviews[key]?.status || 'pending';
        }

        function getSignalKey(signal) {
            return `${signal.video_id}_${signal.stock}_${signal.timestamp}`;
        }

        function renderSignals(signals) {
            const container = document.getElementById('signalsList');
            container.innerHTML = '';
            
            if (signals.length === 0) {
                container.innerHTML = '<div class="loading">í•„í„° ì¡°ê±´ì— ë§ëŠ” ì‹ í˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            signals.forEach(signal => {
                const verification = getVerificationForSignal(signal);
                const reviewStatus = getReviewStatus(signal);
                const signalElement = createSignalElement(signal, verification, reviewStatus);
                container.appendChild(signalElement);
            });
        }

        function createSignalElement(signal, verification, reviewStatus) {
            const card = document.createElement('div');
            card.className = `signal-card ${reviewStatus}`;
            
            const isSuspicious = verification && isSuspiciousSignal(signal, verification);
            const claudeVerification = getClaudeVerification(signal);
            
            if (isSuspicious && reviewStatus === 'pending') {
                card.classList.add('suspicious');
            }
            
            // Add verification stage indicators
            const stages = renderVerificationStages(signal, verification, claudeVerification);
            
            card.innerHTML = `
                <div class="signal-header">
                    <div class="signal-meta">
                        <div>
                            <strong>${signal.influencer}</strong> â€¢ ${signal.upload_date || 'ë‚ ì§œ ë¯¸ìƒ'}
                            <span class="review-status status-${reviewStatus}">${getStatusText(reviewStatus)}</span>
                        </div>
                        <div class="signal-info">
                            <span>ë¹„ë””ì˜¤: ${signal.video_id}</span>
                            <span>ì‹œê°„: ${signal.timestamp}</span>
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-weight: bold;">${signal.summary}</div>
                    ${stages}
                </div>
                
                <div class="signal-body">
                    <div class="original-signal">
                        <div class="section-title">ğŸ“ˆ 1ì°¨: GPT-4o-mini ì¶”ì¶œ ê²°ê³¼</div>
                        <div class="signal-details">
                            <div class="detail-item">
                                <div class="detail-label">ì¢…ëª©</div>
                                <div>${signal.stock}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ì‹ í˜¸</div>
                                <div><span class="signal-badge signal-${signal.signal}">${signal.signal}</span></div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì¸ìš©</div>
                            <div>"${signal.quote}"</div>
                        </div>
                        <div class="detail-item" style="margin-top: 10px;">
                            <div class="detail-label">ë¶„ì„</div>
                            <div>${signal.detail}</div>
                        </div>
                    </div>
                    
                    <div class="gpt-verification">
                        <div class="section-title">ğŸ¤– 2ì°¨: GPT-4o ê²€ì¦ ê²°ê³¼</div>
                        ${renderVerificationResult(verification)}
                    </div>
                    
                    <div class="claude-verification">
                        <div class="section-title">ğŸ” 3ì°¨: Claude Opus ê²€ì¦ ê²°ê³¼</div>
                        ${renderClaudeVerification(claudeVerification)}
                    </div>
                    
                    <div class="human-review">
                        <div class="section-title">ğŸ‘¨â€ğŸ’¼ 4ì°¨: ì¸ê°„ ìµœì¢… ê²€í† </div>
                        ${renderHumanReview(signal, reviewStatus)}
                    </div>
                </div>
            `;
            
            return card;
        }

        function renderVerificationStages(signal, verification, claudeVerification) {
            const hasGptSuspicion = verification && isSuspiciousSignal(signal, verification);
            const hasClaudeResult = claudeVerification !== null;
            
            return `
                <div class="verification-stages">
                    <div class="stage-indicator">
                        <span class="stage-badge stage-complete">1ì°¨ âœ…</span>
                        <span class="stage-badge ${verification ? 'stage-complete' : 'stage-missing'}">
                            2ì°¨ ${verification ? (hasGptSuspicion ? 'âš ï¸' : 'âœ…') : 'âŒ'}
                        </span>
                        <span class="stage-badge ${hasClaudeResult ? 
                            (claudeVerification.verdict === 'confirmed' ? 'stage-complete' :
                             claudeVerification.verdict === 'suspicious' ? 'stage-warning' : 'stage-error') : 
                            'stage-na'}">
                            3ì°¨ ${hasClaudeResult ? 
                                (claudeVerification.verdict === 'confirmed' ? 'âœ…' :
                                 claudeVerification.verdict === 'suspicious' ? 'âš ï¸' : 'âŒ') : 
                                'ëŒ€ê¸°'}
                        </span>
                    </div>
                </div>
            `;
        }

        function renderVerificationResult(verification) {
            if (!verification) {
                return '<div class="verification-result error">ê²€ì¦ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
            
            const hasErrors = !verification.stock_correct || 
                             !verification.signal_correct || 
                             !verification.quote_correct || 
                             !verification.speaker_correct ||
                             verification.error_type;
            
            const resultClass = hasErrors ? 'error' : '';
            const status = hasErrors ? 'ì˜ì‹¬ (3ì°¨ ê²€ì¦ ëŒ€ìƒ)' : 'í™•ì‹¤ (í†µê³¼)';
            
            return `
                <div class="verification-result ${resultClass}">
                    <div style="margin-bottom: 10px;"><strong>íŒì •:</strong> ${status}</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 10px;">
                        <div><strong>ì¢…ëª©:</strong> ${verification.stock_correct ? 'âœ…' : 'âŒ'}</div>
                        <div><strong>ì‹ í˜¸:</strong> ${verification.signal_correct ? 'âœ…' : 'âŒ'}</div>
                        <div><strong>ì¸ìš©:</strong> ${verification.quote_correct ? 'âœ…' : 'âŒ'}</div>
                        <div><strong>í™”ì:</strong> ${verification.speaker_correct ? 'âœ…' : 'âŒ'}</div>
                    </div>
                    ${verification.suggested_signal !== verification.signal ? 
                        `<div><strong>ì œì•ˆëœ ì‹ í˜¸:</strong> <span class="signal-badge signal-${verification.suggested_signal}">${verification.suggested_signal}</span></div>` : 
                        ''
                    }
                    ${verification.error_type ? `<div><strong>ì˜¤ë¥˜ ìœ í˜•:</strong> ${verification.error_type}</div>` : ''}
                    <div><strong>ì„¤ëª…:</strong> ${verification.explanation}</div>
                </div>
            `;
        }

        function renderClaudeVerification(claudeVerification) {
            if (!claudeVerification) {
                return '<div class="verification-result error">ê²€ì¦ ëŒ€ê¸°ì¤‘</div>';
            }
            
            const verdictClass = claudeVerification.verdict === 'confirmed' ? '' : 
                               claudeVerification.verdict === 'suspicious' ? 'error' :
                               'error';
            
            const verdictText = {
                'confirmed': 'í™•ì¸ë¨',
                'suspicious': 'ì˜ì‹¬ë¨', 
                'rejected': 'ê±°ë¶€ë¨'
            }[claudeVerification.verdict] || claudeVerification.verdict;
            
            const confidencePercent = Math.round(claudeVerification.confidence * 100);
            
            return `
                <div class="verification-result ${verdictClass}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div><strong>íŒì •:</strong> ${verdictText}</div>
                        <div><strong>ì‹ ë¢°ë„:</strong> ${confidencePercent}%</div>
                    </div>
                    <div><strong>ìƒì„¸ ë¶„ì„:</strong></div>
                    <div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 14px; line-height: 1.4;">
                        ${claudeVerification.reason}
                    </div>
                </div>
            `;
        }

        function renderHumanReview(signal, reviewStatus) {
            const key = getSignalKey(signal);
            const review = humanReviews[key];
            
            let reviewContent = '';
            if (review && review.notes) {
                reviewContent = `
                    <div class="detail-item" style="margin-bottom: 15px;">
                        <div class="detail-label">ê²€í†  ë…¸íŠ¸</div>
                        <div>${review.notes}</div>
                    </div>
                `;
            }
            
            return `
                ${reviewContent}
                <div class="review-actions">
                    <button class="action-btn approve" onclick="reviewSignal('${key}', 'approved')">âœ… ìŠ¹ì¸</button>
                    <button class="action-btn reject" onclick="reviewSignal('${key}', 'rejected')">âŒ ê±°ë¶€</button>
                    <button class="action-btn modify" onclick="reviewSignal('${key}', 'modified')">ğŸ”„ ìˆ˜ì • í•„ìš”</button>
                </div>
            `;
        }

        function getStatusText(status) {
            const statusTexts = {
                'pending': 'ê²€í†  ëŒ€ê¸°',
                'approved': 'ìŠ¹ì¸ë¨',
                'rejected': 'ê±°ë¶€ë¨',
                'modified': 'ìˆ˜ì •ë¨'
            };
            return statusTexts[status] || status;
        }

        function reviewSignal(signalKey, status) {
            const notes = prompt(`ê²€í†  ë…¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):`);
            
            humanReviews[signalKey] = {
                status: status,
                notes: notes || '',
                timestamp: new Date().toISOString(),
                reviewer: 'human' // ë‚˜ì¤‘ì— ì‚¬ìš©ì ì •ë³´ë¡œ í™•ì¥ ê°€ëŠ¥
            };
            
            localStorage.setItem('signalReviews', JSON.stringify(humanReviews));
            filterAndRenderSignals();
            updateStats();
        }

        function updateStats() {
            const totalSignals = signalsData.length;
            let suspiciousCount = 0;
            let reviewedCount = 0;
            let approvedCount = 0;
            let claudeConfirmed = 0;
            let claudeSuspicious = 0;
            let claudeRejected = 0;
            
            signalsData.forEach(signal => {
                const verification = getVerificationForSignal(signal);
                const reviewStatus = getReviewStatus(signal);
                const claudeVerification = getClaudeVerification(signal);
                
                if (verification && isSuspiciousSignal(signal, verification)) {
                    suspiciousCount++;
                }
                
                if (reviewStatus !== 'pending') {
                    reviewedCount++;
                }
                
                if (reviewStatus === 'approved') {
                    approvedCount++;
                }
                
                // Claude ê²°ê³¼ê°€ ìˆëŠ” ëª¨ë“  ì‹œê·¸ë„ì— ëŒ€í•´ í†µê³„ ì§‘ê³„
                if (claudeVerification) {
                    switch (claudeVerification.verdict) {
                        case 'confirmed':
                            claudeConfirmed++;
                            break;
                        case 'suspicious':
                            claudeSuspicious++;
                            break;
                        case 'rejected':
                            claudeRejected++;
                            break;
                    }
                }
            });
            
            document.getElementById('totalSignals').textContent = totalSignals;
            document.getElementById('suspiciousSignals').textContent = suspiciousCount;
            document.getElementById('claudeConfirmed').textContent = claudeConfirmed;
            document.getElementById('claudeSuspicious').textContent = claudeSuspicious;
            document.getElementById('claudeRejected').textContent = claudeRejected;
            document.getElementById('reviewedSignals').textContent = reviewedCount;
            document.getElementById('approvedSignals').textContent = approvedCount;
        }

        function exportResults() {
            const results = {
                exportDate: new Date().toISOString(),
                humanReviews: humanReviews,
                totalSignals: signalsData.length,
                reviewStats: {
                    pending: Object.values(humanReviews).filter(r => r.status === 'pending').length,
                    approved: Object.values(humanReviews).filter(r => r.status === 'approved').length,
                    rejected: Object.values(humanReviews).filter(r => r.status === 'rejected').length,
                    modified: Object.values(humanReviews).filter(r => r.status === 'modified').length
                }
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `signal-reviews-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.humanReviews) {
                        humanReviews = data.humanReviews;
                        localStorage.setItem('signalReviews', JSON.stringify(humanReviews));
                        filterAndRenderSignals();
                        updateStats();
                        alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë°ì´í„° íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
            event.target.value = '';
        }
    </script>
</body>
</html>