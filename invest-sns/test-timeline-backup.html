<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투자 SNS - 실시간 피드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0f0f0f;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            padding-bottom: 80px; /* Space for bottom tab bar */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        /* Tab Management */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .more-link {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
        }

        .more-link:hover {
            text-decoration: underline;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .portfolio-stat {
            text-align: center;
            padding: 12px;
            background: #0f0f0f;
            border-radius: 8px;
        }

        .portfolio-stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .portfolio-stat-value.positive {
            color: #10b981;
        }

        .portfolio-stat-value.negative {
            color: #dc2626;
        }

        .portfolio-stat-label {
            font-size: 12px;
            color: #888;
        }

        .holdings-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .holding-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .holding-item:last-child {
            border-bottom: none;
        }

        .holding-info {
            flex: 1;
        }

        .holding-name {
            font-weight: 500;
        }

        .holding-details {
            font-size: 12px;
            color: #888;
        }

        .holding-pnl {
            text-align: right;
            font-weight: 500;
        }

        .holding-pnl.positive {
            color: #10b981;
        }

        .holding-pnl.negative {
            color: #dc2626;
        }

        /* SNS Feed Styles */
        .sns-compose {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sns-compose-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .sns-compose textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 12px;
        }

        .sns-compose textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .sns-compose-tools {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .sns-image-input {
            flex: 1;
            min-width: 200px;
        }

        .sns-image-input input {
            width: 100%;
            padding: 8px 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        .sns-image-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .stock-tag-input {
            position: relative;
        }

        .sns-compose-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sns-share-options {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 14px;
            color: #888;
        }

        .sns-post {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .sns-post:hover {
            border-color: #444;
        }

        .sns-post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .sns-author-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .sns-post-info {
            flex: 1;
        }

        .sns-author-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .sns-post-time {
            font-size: 12px;
            color: #888;
        }

        .sns-post-content {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .sns-post-image {
            margin-bottom: 12px;
        }

        .sns-post-image img {
            max-width: 100%;
            border-radius: 8px;
        }

        .sns-post-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .sns-stock-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }

        .sns-post-actions {
            display: flex;
            gap: 16px;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #333;
        }

        .sns-action-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s;
        }

        .sns-action-btn:hover {
            background: #333;
            color: white;
        }

        .sns-action-btn.active {
            color: #667eea;
        }

        .sns-comments {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #333;
            display: none;
        }

        .sns-comments.active {
            display: block;
        }

        .sns-comment {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: #0f0f0f;
            border-radius: 8px;
        }

        .sns-comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            flex-shrink: 0;
        }

        .sns-comment-content {
            flex: 1;
        }

        .sns-comment-author {
            font-weight: 500;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .sns-comment-text {
            font-size: 14px;
            color: #d1d5db;
            margin-bottom: 2px;
        }

        .sns-comment-time {
            font-size: 11px;
            color: #888;
        }

        .sns-scrap-share {
            background: #1e3a8a;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .sns-scrap-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #93c5fd;
        }

        .sns-link-card {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            display: block;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
        }

        .sns-link-card:hover {
            border-color: #667eea;
            background: #1a1a1a;
        }

        .sns-link-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .sns-link-description {
            font-size: 13px;
            color: #888;
            margin-bottom: 4px;
        }

        .sns-link-url {
            font-size: 12px;
            color: #667eea;
            word-break: break-all;
        }

        /* Feed Item Styles */
        .feed-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .feed-item-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .feed-item-info {
            flex: 1;
        }

        .feed-item-author {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .feed-item-time {
            font-size: 12px;
            color: #888;
        }

        .feed-item-content {
            margin-bottom: 12px;
        }

        .feed-item-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .feed-action {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .feed-action:hover {
            color: white;
            background: #333;
        }

        .feed-action.active {
            color: #667eea;
        }

        /* Memo Styles */
        .memo-toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .memo-search {
            flex: 1;
            min-width: 200px;
        }

        .memo-search input {
            width: 100%;
            padding: 10px 12px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .memo-search input:focus {
            outline: none;
            border-color: #667eea;
        }

        .memo-filters {
            display: flex;
            gap: 8px;
        }

        .memo-filter-btn {
            padding: 8px 16px;
            background: transparent;
            border: 2px solid #333;
            border-radius: 20px;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-filter-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .memo-filter-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .memo-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }

        .memo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .memo-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .memo-date {
            font-size: 12px;
            color: #888;
        }

        .memo-tag {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .memo-actions {
            display: flex;
            gap: 8px;
        }

        .memo-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #888;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .memo-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .memo-content {
            color: #d1d5db;
            line-height: 1.5;
        }

        .memo-form {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .memo-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .memo-form-title {
            font-size: 16px;
            font-weight: 600;
        }

        .memo-type-toggle {
            display: flex;
            gap: 8px;
        }

        .memo-type-btn {
            padding: 6px 12px;
            background: transparent;
            border: 2px solid #333;
            border-radius: 16px;
            color: #888;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-type-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .memo-type-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .memo-stock-select {
            margin-bottom: 16px;
            display: none;
        }

        .memo-stock-select.active {
            display: block;
        }

        .stock-search-memo {
            width: 100%;
            padding: 10px 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .stock-search-memo:focus {
            outline: none;
            border-color: #667eea;
        }

        .sns-share-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 14px;
        }

        .sns-share-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #667eea;
        }

        /* Notes Tab Styles (메모+스크랩 통합) */
        .note-creation-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .note-create-tab {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid #333;
            border-radius: 25px;
            color: #888;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .note-create-tab:hover {
            border-color: #667eea;
            color: white;
        }

        .note-create-tab.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .note-form {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .notes-toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .notes-search {
            flex: 1;
            min-width: 200px;
        }

        .notes-search input {
            width: 100%;
            padding: 10px 12px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .notes-search input:focus {
            outline: none;
            border-color: #667eea;
        }

        .notes-filters {
            display: flex;
            gap: 8px;
        }

        .notes-filter-btn {
            padding: 8px 16px;
            background: transparent;
            border: 2px solid #333;
            border-radius: 20px;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .notes-filter-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .notes-filter-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .folder-filter {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .folder-filter-btn {
            padding: 6px 16px;
            background: transparent;
            border: 1px solid #333;
            border-radius: 16px;
            color: #888;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-filter-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .folder-filter-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .note-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
            transition: all 0.2s;
        }

        .note-item:hover {
            border-color: #444;
        }

        .note-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .note-item-info {
            flex: 1;
        }

        .note-item-type {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .note-type-icon {
            font-size: 18px;
        }

        .note-type-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            font-weight: 500;
        }

        .note-item-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            color: white;
        }

        .note-item-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .note-date {
            font-size: 12px;
            color: #888;
        }

        .note-folder {
            background: #374151;
            color: #d1d5db;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .note-tag {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .note-item-actions {
            display: flex;
            gap: 8px;
        }

        .note-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #888;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .note-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .note-item-content {
            color: #d1d5db;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .note-link-card {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .note-link-card:hover {
            border-color: #667eea;
        }

        .note-link-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: white;
        }

        .note-link-url {
            font-size: 12px;
            color: #667eea;
            word-break: break-all;
        }

        .note-sns-share {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note-sns-share input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #667eea;
        }

        /* Scrap Styles */
        .scrap-toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .scrap-search {
            flex: 1;
            min-width: 200px;
        }

        .scrap-search input {
            width: 100%;
            padding: 10px 12px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .scrap-search input:focus {
            outline: none;
            border-color: #667eea;
        }

        .folder-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .folder-tab {
            padding: 8px 16px;
            background: transparent;
            border: 2px solid #333;
            border-radius: 20px;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-tab:hover {
            border-color: #667eea;
            color: white;
        }

        .folder-tab.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .scrap-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }

        .scrap-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .scrap-info {
            flex: 1;
        }

        .scrap-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: white;
        }

        .scrap-url {
            font-size: 12px;
            color: #888;
            word-break: break-all;
            margin-bottom: 4px;
        }

        .scrap-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .scrap-date {
            font-size: 12px;
            color: #888;
        }

        .scrap-folder {
            background: #374151;
            color: #d1d5db;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .scrap-tag {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .scrap-actions {
            display: flex;
            gap: 8px;
        }

        .scrap-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #888;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .scrap-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .scrap-note {
            color: #d1d5db;
            font-size: 14px;
            margin-top: 8px;
            line-height: 1.5;
        }

        .scrap-form {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .scrap-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .scrap-form-title {
            font-size: 16px;
            font-weight: 600;
        }

        .url-preview-card {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            display: none;
        }

        .url-preview-card.active {
            display: block;
        }

        .url-preview-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .url-preview-description {
            font-size: 13px;
            color: #888;
        }

        /* Notification Styles */
        .notification-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .notification-icon.like {
            background: #dc2626;
        }

        .notification-icon.comment {
            background: #3b82f6;
        }

        .notification-icon.follow {
            background: #10b981;
        }

        .notification-content {
            flex: 1;
        }

        .notification-text {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .notification-time {
            font-size: 12px;
            color: #888;
        }

        /* Profile Card Styles */
        .profile-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .profile-large-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-bio {
            color: #888;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .profile-stats {
            font-size: 12px;
            color: #888;
        }

        .follow-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .follow-btn:hover {
            background: #5a67d8;
        }

        .follow-btn.following {
            background: #374151;
            color: #d1d5db;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #374151;
            color: #d1d5db;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        /* Existing Timeline Styles - Market Filter Tabs */
        .market-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .market-tab {
            padding: 12px 24px;
            border: 2px solid #333;
            border-radius: 25px;
            background: transparent;
            color: #888;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .market-tab:hover {
            border-color: #667eea;
            color: white;
        }

        .market-tab.active.korean {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
        }

        .market-tab.active.us {
            border-color: #10b981;
            background: #10b981;
            color: white;
        }

        .market-tab.active.crypto {
            border-color: #f59e0b;
            background: #f59e0b;
            color: white;
        }

        /* Filter Panel Toggle */
        .filter-toggle-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .filter-toggle-btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .filter-toggle-btn:hover {
            background: #5a67d8;
        }

        .filter-count-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Advanced Filter Section */
        .advanced-filters {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }

        .advanced-filters.open {
            display: block;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #d1d5db;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Stock Search */
        .stock-search-container {
            position: relative;
        }

        .stock-search {
            width: 100%;
            padding: 12px 16px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .stock-search:focus {
            outline: none;
            border-color: #667eea;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #0f0f0f;
            border: 2px solid #333;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .autocomplete-item:hover {
            background: #1a1a1a;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .stock-code-small {
            color: #888;
            font-size: 12px;
            font-family: monospace;
        }

        .selected-stocks {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .stock-tag {
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stock-tag.korean {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
        }

        .stock-tag.us {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .stock-tag.crypto {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .stock-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .stock-tag .remove-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Filter Panel Styles */
        .filter-panel {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .filter-panel:last-child {
            margin-bottom: 0;
        }

        .filter-panel-header {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1a1a1a;
            border-radius: 8px 8px 0 0;
        }

        .filter-panel.collapsed .filter-panel-header {
            border-radius: 8px;
        }

        .filter-panel-header:hover {
            background: #222;
        }

        .filter-panel-title {
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-count {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 8px;
        }

        .filter-panel-toggle {
            font-size: 12px;
            color: #888;
            transition: transform 0.2s;
        }

        .filter-panel.collapsed .filter-panel-toggle {
            transform: rotate(-90deg);
        }

        .filter-panel-content {
            padding: 16px;
            border-top: 1px solid #333;
        }

        .filter-panel.collapsed .filter-panel-content {
            display: none;
        }

        .filter-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-control-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #555;
            border-radius: 16px;
            color: #888;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-control-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .filter-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #667eea;
        }

        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
            color: #d1d5db;
        }

        /* Period Filter Styles */
        .period-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .period-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 8px 16px;
            border: 2px solid #333;
            border-radius: 20px;
            background: transparent;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .period-btn:hover {
            border-color: #667eea;
            color: white;
        }

        .period-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .custom-date-range {
            margin-top: 8px;
        }

        .date-inputs {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .date-input {
            padding: 8px 12px;
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        .date-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .date-separator {
            color: #888;
            font-weight: bold;
        }

        /* Basic Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-outline {
            background: transparent;
            color: #888;
            border: 2px solid #333;
        }

        .btn-outline:hover {
            border-color: #667eea;
            color: white;
        }

        .btn-outline.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .btn-refresh {
            background: #764ba2;
            color: white;
        }

        .timeline {
            display: grid;
            gap: 20px;
        }

        .filing-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            position: relative;
        }

        .filing-card:hover {
            border-color: #667eea;
            background: #1f1f1f;
        }

        .news-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            border-left: 4px solid #f59e0b;
            position: relative;
        }

        .news-card:hover {
            border-color: #f59e0b;
            background: #1f1f1f;
        }

        .card-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
        }

        .card-action-btn {
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: #888;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .card-action-btn:hover {
            color: white;
            background: rgba(0, 0, 0, 0.9);
        }

        .card-action-btn.active {
            color: #667eea;
        }

        .filing-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .filing-time {
            font-family: monospace;
            font-size: 14px;
            color: #888;
            min-width: 50px;
        }

        .filing-icon {
            font-size: 24px;
        }

        .filing-content {
            flex: 1;
        }

        .filing-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .company-name {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .grade-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .grade-a {
            background: #065f46;
            color: #10b981;
        }

        .grade-b {
            background: #92400e;
            color: #f59e0b;
        }

        .grade-c {
            background: #374151;
            color: #9ca3af;
        }

        .stock-code {
            background: #374151;
            color: #d1d5db;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
        }

        .report-name {
            color: #d1d5db;
            margin-bottom: 10px;
        }

        .ai-summary {
            background: #1e3a8a;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .ai-summary-label {
            font-size: 12px;
            color: #93c5fd;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .ai-summary-text {
            color: #dbeafe;
            font-size: 14px;
        }

        .dart-link, .news-link {
            background: transparent;
            color: #888;
            border: 2px solid #333;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
        }

        .dart-link:hover {
            border-color: #667eea;
            color: white;
        }

        .news-link:hover {
            border-color: #f59e0b;
            color: white;
        }

        .importance-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .importance-urgent {
            background: #991b1b;
            color: #fecaca;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .importance-high {
            background: #dc2626;
            color: #fecaca;
        }

        .importance-normal {
            background: #d97706;
            color: #fed7aa;
        }

        .importance-low {
            background: #374151;
            color: #9ca3af;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .error {
            background: #7f1d1d;
            border: 1px solid #dc2626;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            color: #fecaca;
        }

        .load-more {
            text-align: center;
            margin-top: 30px;
        }

        /* Bottom Tab Bar (Updated to 6 tabs) */
        .bottom-tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            z-index: 1000;
        }

        .tab-item {
            flex: 1;
            background: none;
            border: none;
            color: #888;
            padding: 10px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            font-size: 11px;
            transition: all 0.2s;
            position: relative;
        }

        .tab-item.active {
            color: #667eea;
        }

        .tab-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-icon {
            font-size: 18px;
        }

        .tab-badge {
            position: absolute;
            top: 4px;
            right: 15%;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Portfolio Management */
        .portfolio-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .portfolio-item-info {
            flex: 1;
        }

        .portfolio-item-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .portfolio-item-details {
            font-size: 12px;
            color: #888;
        }

        .portfolio-item-actions {
            display: flex;
            gap: 8px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #333;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-close:hover {
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-checkboxes {
                grid-template-columns: 1fr;
            }

            .filing-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .filing-time {
                min-width: auto;
            }

            .selected-stocks {
                justify-content: center;
            }

            .period-buttons {
                justify-content: center;
            }

            .period-btn {
                flex: 1;
                min-width: 70px;
                text-align: center;
            }

            .date-inputs {
                justify-content: center;
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }

            .date-input {
                width: 100%;
                max-width: 200px;
            }

            .advanced-filters {
                padding: 15px;
            }

            .filter-panel-header {
                padding: 10px 12px;
            }

            .filter-panel-content {
                padding: 12px;
            }

            .market-tabs {
                flex-direction: column;
                align-items: center;
            }

            .market-tab {
                width: 100%;
                max-width: 300px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .portfolio-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-item {
                font-size: 10px;
            }

            .tab-icon {
                font-size: 16px;
            }

            .memo-toolbar, .scrap-toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .memo-search, .scrap-search {
                min-width: 100%;
            }

            .memo-filters, .folder-tabs {
                justify-content: center;
            }

            .sns-compose-tools {
                flex-direction: column;
            }

            .sns-image-input {
                min-width: 100%;
            }

            .sns-post-actions {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }

            .period-btn {
                font-size: 12px;
                padding: 6px 12px;
            }

            .checkbox-item label {
                font-size: 13px;
            }

            .stock-tag {
                font-size: 13px;
                padding: 5px 10px;
            }

            .market-tab {
                padding: 10px 16px;
                font-size: 13px;
            }

            .filter-checkboxes {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10px;
                max-height: 90vh;
            }

            .memo-meta, .scrap-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .sns-author-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .tab-item {
                padding: 8px 2px;
            }

            .tab-icon {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Tab 1: Dashboard -->
    <div id="dashboard" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1>🏠 대시보드</h1>
                <p>나의 투자 현황과 최신 소식을 한눈에</p>
            </div>

            <div class="dashboard-grid">
                <!-- Portfolio Summary -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">📊 내 포트폴리오</div>
                        <a href="#" class="more-link" onclick="switchTab('profile')">더보기</a>
                    </div>
                    <div class="portfolio-summary" id="portfolioSummary">
                        <div class="portfolio-stat">
                            <div class="portfolio-stat-value" id="totalAssets">₩12,450,000</div>
                            <div class="portfolio-stat-label">총 자산</div>
                        </div>
                        <div class="portfolio-stat">
                            <div class="portfolio-stat-value positive" id="todayReturn">+₩125,000</div>
                            <div class="portfolio-stat-label">오늘 수익</div>
                        </div>
                        <div class="portfolio-stat">
                            <div class="portfolio-stat-value positive" id="returnRate">+2.8%</div>
                            <div class="portfolio-stat-label">수익률</div>
                        </div>
                    </div>
                    <div class="holdings-list" id="holdingsList">
                        <!-- Holdings will be populated by JS -->
                    </div>
                </div>

                <!-- Recent Posts from Following (SNS Feed Preview) -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">💬 구독한 사람들 최신 글</div>
                        <a href="#" class="more-link" onclick="switchTab('sns')">더보기</a>
                    </div>
                    <div id="snsFeedPreview">
                        <!-- SNS posts will be populated by JS -->
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Recent Notes (메모+스크랩 통합) -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">📝 최근 노트</div>
                        <a href="#" class="more-link" onclick="switchTab('notes')">더보기</a>
                    </div>
                    <div id="recentNotes">
                        <!-- Recent notes will be populated by JS -->
                    </div>
                </div>

                <!-- Filtered News/Filings -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">📰 맞춤 뉴스/공시</div>
                        <a href="#" class="more-link" onclick="switchTab('timeline')">더보기</a>
                    </div>
                    <div id="filteredFeed">
                        <!-- Filtered content will be populated by JS -->
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Notifications -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">🔔 알림</div>
                        <a href="#" class="more-link" onclick="openNotifications()">더보기</a>
                    </div>
                    <div id="notificationsList">
                        <!-- Notifications will be populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2: SNS Feed (NEW) -->
    <div id="sns" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>💬 SNS 피드</h1>
                <p>투자자들과 생각을 나누고 소통하세요</p>
            </div>

            <!-- Post Compose -->
            <div class="sns-compose" id="snsCompose">
                <div class="sns-compose-header">
                    <div class="sns-author-avatar">김</div>
                    <div>
                        <div style="font-weight: 600;">김투자</div>
                        <div style="font-size: 12px; color: #888;">무엇을 생각하고 계신가요?</div>
                    </div>
                </div>
                
                <textarea id="snsPostContent" placeholder="투자 아이디어, 분석, 생각을 자유롭게 공유해보세요..."></textarea>
                
                <div class="sns-compose-tools">
                    <div class="sns-image-input">
                        <input type="url" id="snsImageUrl" placeholder="이미지 URL (선택사항)">
                    </div>
                    <div class="stock-tag-input">
                        <input type="text" id="snsStockTag" placeholder="종목 태그 (예: 삼성전자)" style="width: 200px; padding: 8px 12px; background: #0f0f0f; border: 2px solid #333; border-radius: 6px; color: white; font-size: 14px;">
                    </div>
                </div>
                
                <div class="sns-compose-footer">
                    <div class="sns-share-options">
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" id="snsSharePublic" checked>
                            공개 게시
                        </label>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="clearSNSCompose()">취소</button>
                        <button class="btn btn-primary" onclick="publishSNSPost()">발행</button>
                    </div>
                </div>
            </div>

            <!-- SNS Feed -->
            <div id="snsFeedList">
                <!-- SNS posts will be populated by JS -->
            </div>

            <div id="snsEmpty" class="empty-state" style="display: none;">
                <div class="empty-state-icon">💬</div>
                <h3>아직 글이 없습니다</h3>
                <p>첫 번째 글을 작성해보세요!</p>
            </div>
        </div>
    </div>

    <!-- Tab 3: Timeline -->
    <div id="timeline-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>📰 타임라인</h1>
                <p>DART 공시와 네이버 증권 뉴스를 실시간으로 확인하세요</p>
            </div>

            <!-- Market Filter Tabs (최상단) -->
            <div class="market-tabs">
                <button class="market-tab korean active" data-market="korean">
                    🇰🇷 한국주식
                </button>
                <button class="market-tab us active" data-market="us">
                    🇺🇸 미국주식
                </button>
                <button class="market-tab crypto active" data-market="crypto">
                    ₿ 코인
                </button>
            </div>

            <!-- Filter Toggle Button -->
            <div class="filter-toggle-section">
                <button id="filterToggleBtn" class="filter-toggle-btn">
                    🔍 필터
                    <span id="filterCountBadge" class="filter-count-badge" style="display: none;">0</span>
                </button>
            </div>

            <!-- Advanced Filter Section -->
            <div id="advancedFilters" class="advanced-filters">
                <!-- Stock Search -->
                <div class="filter-section">
                    <h3>📊 종목 검색</h3>
                    <div class="stock-search-container">
                        <input type="text" id="stockSearch" class="stock-search" placeholder="종목명 또는 코드를 입력하세요...">
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                    <div id="selectedStocks" class="selected-stocks"></div>
                </div>
            </div>

            <div class="controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="공시명이나 뉴스 제목으로 검색...">
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-outline active" data-filter="all">전체</button>
                    <button class="btn btn-outline" data-filter="filings">📋 공시</button>
                    <button class="btn btn-outline" data-filter="news">📰 뉴스</button>
                </div>
                <button class="btn btn-refresh" onclick="refreshData()">🔄 새로고침</button>
            </div>

            <div id="error" class="error" style="display: none;"></div>
            <div id="timeline" class="timeline"></div>
            <div id="loading" class="loading">데이터를 불러오는 중...</div>
            <div class="load-more">
                <button id="loadMore" class="btn btn-primary" style="display: none;">더 보기</button>
            </div>
        </div>
    </div>

    <!-- Tab 4: Notes (메모+스크랩 통합) -->
    <div id="notes" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>📝 노트</h1>
                <p>메모, 스크랩, 아이디어를 한 곳에서 관리하세요</p>
            </div>

            <!-- Note Creation Options -->
            <div class="note-creation-tabs">
                <button class="note-create-tab active" data-type="memo" onclick="switchNoteCreation('memo')">
                    ✍️ 메모 작성
                </button>
                <button class="note-create-tab" data-type="scrap" onclick="switchNoteCreation('scrap')">
                    🔗 링크 스크랩
                </button>
            </div>

            <!-- Memo Form -->
            <div class="note-form" id="memoForm">
                <div class="form-group">
                    <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                        <button class="memo-type-btn active" data-type="free">자유 메모</button>
                        <button class="memo-type-btn" data-type="stock">종목 메모</button>
                    </div>
                </div>
                
                <div class="memo-stock-select" id="memoStockSelect">
                    <label class="form-label">종목 선택</label>
                    <input type="text" id="memoStockSearch" class="stock-search-memo" placeholder="종목명 또는 코드를 검색하세요...">
                    <div id="memoAutocompleteDropdown" class="autocomplete-dropdown"></div>
                    <div id="selectedMemoStock" style="margin-top: 8px;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">메모 내용</label>
                    <textarea id="memoContent" class="form-textarea" placeholder="투자 아이디어, 분석, 생각 등을 자유롭게 작성하세요..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">폴더 (선택사항)</label>
                    <select id="memoFolder" class="form-select">
                        <option value="">폴더 선택</option>
                        <option value="투자아이디어">투자아이디어</option>
                        <option value="종목분석">종목분석</option>
                        <option value="시장동향">시장동향</option>
                        <option value="개인기록">개인기록</option>
                    </select>
                </div>
                
                <div class="sns-share-checkbox">
                    <input type="checkbox" id="memoToSNS">
                    <label for="memoToSNS">SNS에 공유하기</label>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="saveMemo()">메모 저장</button>
                    <button class="btn btn-secondary" onclick="clearNoteForm()">취소</button>
                </div>
            </div>

            <!-- Scrap Form -->
            <div class="note-form" id="scrapForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" id="scrapUrl" class="form-input" placeholder="https://example.com" onblur="previewUrl()">
                </div>

                <!-- URL Preview Card -->
                <div id="urlPreviewCard" class="url-preview-card">
                    <div class="url-preview-title" id="previewTitle">링크 제목</div>
                    <div class="url-preview-description" id="previewDescription">링크 설명</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">제목</label>
                    <input type="text" id="scrapTitle" class="form-input" placeholder="스크랩 제목">
                </div>
                
                <div class="form-group">
                    <label class="form-label">폴더</label>
                    <select id="scrapFolder" class="form-select">
                        <option value="외부링크">외부링크</option>
                        <option value="뉴스">뉴스</option>
                        <option value="공시">공시</option>
                        <option value="리서치">리서치</option>
                        <option value="참고자료">참고자료</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">태그 (선택사항)</label>
                    <input type="text" id="scrapTags" class="form-input" placeholder="태그를 쉼표로 구분 (예: 삼성전자, 실적, 분석)">
                </div>
                
                <div class="form-group">
                    <label class="form-label">내 코멘트</label>
                    <textarea id="scrapNote" class="form-textarea" placeholder="이 링크에 대한 나의 생각과 코멘트..."></textarea>
                </div>
                
                <div class="sns-share-checkbox">
                    <input type="checkbox" id="scrapToSNS">
                    <label for="scrapToSNS">SNS에 공유하기</label>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="saveScrap()">스크랩 저장</button>
                    <button class="btn btn-secondary" onclick="clearNoteForm()">취소</button>
                </div>
            </div>

            <!-- Notes Toolbar -->
            <div class="notes-toolbar">
                <div class="notes-search">
                    <input type="text" id="notesSearchInput" placeholder="노트 검색...">
                </div>
                <div class="notes-filters">
                    <button class="notes-filter-btn active" data-filter="all">📋 전체</button>
                    <button class="notes-filter-btn" data-filter="memo">✍️ 메모</button>
                    <button class="notes-filter-btn" data-filter="scrap">🔗 스크랩</button>
                    <button class="notes-filter-btn" data-filter="news">📰 뉴스</button>
                </div>
            </div>

            <!-- Folder Filter -->
            <div class="folder-filter" style="margin-bottom: 20px; text-align: center;">
                <button class="folder-filter-btn active" data-folder="">전체 폴더</button>
                <button class="folder-filter-btn" data-folder="투자아이디어">투자아이디어</button>
                <button class="folder-filter-btn" data-folder="종목분석">종목분석</button>
                <button class="folder-filter-btn" data-folder="뉴스">뉴스</button>
                <button class="folder-filter-btn" data-folder="외부링크">외부링크</button>
            </div>

            <!-- Sort Options -->
            <div style="margin-bottom: 20px; text-align: center;">
                <button class="btn btn-outline active" data-sort="newest">최신순</button>
                <button class="btn btn-outline" data-sort="oldest">오래된순</button>
            </div>

            <!-- Notes List -->
            <div id="notesList">
                <!-- Notes will be populated by JS -->
            </div>

            <div id="notesEmpty" class="empty-state" style="display: none;">
                <div class="empty-state-icon">📝</div>
                <h3>작성된 노트가 없습니다</h3>
                <p>첫 번째 노트를 작성해보세요!</p>
            </div>
        </div>
    </div>

    <!-- Tab 5: Profile (통합된 프로필 & 구독 관리) -->
    <div id="profile" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>👤 프로필 & 설정</h1>
                <p>내 정보, 구독 관리, 투자 설정을 한 곳에서</p>
            </div>

            <div class="dashboard-grid">
                <!-- User Profile -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">내 프로필</div>
                        <button class="btn btn-primary" onclick="editProfile()">수정</button>
                    </div>
                    <div id="profileInfo">
                        <div class="profile-card">
                            <div class="profile-large-avatar" id="myAvatar">김</div>
                            <div class="profile-info">
                                <div class="profile-name" id="myName">김투자</div>
                                <div class="profile-bio" id="myBio">10년차 개미투자자, 장기투자 선호</div>
                                <div class="profile-stats">팔로워 <span id="myFollowers">156</span>명 • 팔로잉 <span id="myFollowing">23</span>명 • 글 <span id="myPosts">47</span>개</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Management -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">포트폴리오 관리</div>
                        <button class="btn btn-primary" onclick="addToPortfolio()">종목 추가</button>
                    </div>
                    <div id="portfolioManagement">
                        <!-- Portfolio items will be populated by JS -->
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Following Management (구독 탭 내용 통합) -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">구독 관리</div>
                        <div>
                            <button class="btn btn-outline active" data-following-filter="following" onclick="switchFollowingFilter(this)">팔로잉</button>
                            <button class="btn btn-outline" data-following-filter="recommended" onclick="switchFollowingFilter(this)">추천</button>
                        </div>
                    </div>
                    
                    <!-- Following List -->
                    <div id="followingList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Following users will be populated by JS -->
                    </div>
                    
                    <!-- Recommended Users -->
                    <div id="recommendedUsers" style="max-height: 400px; overflow-y: auto; display: none;">
                        <!-- Recommended users will be populated by JS -->
                    </div>
                    
                    <div id="followingEmpty" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">👥</div>
                        <h3>팔로우하는 사용자가 없습니다</h3>
                        <p>관심있는 투자자를 팔로우해보세요!</p>
                    </div>
                </div>

                <!-- Settings -->
                <div class="dashboard-card">
                    <div class="section-header">
                        <div class="section-title">설정</div>
                    </div>
                    <div id="settingsPanel">
                        <div class="form-group">
                            <label class="form-label">알림 설정</label>
                            <div class="checkbox-item">
                                <input type="checkbox" id="notifComments" checked>
                                <label for="notifComments">새로운 댓글</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="notifLikes" checked>
                                <label for="notifLikes">좋아요</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="notifFollows" checked>
                                <label for="notifFollows">새로운 팔로워</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="notifImportant" checked>
                                <label for="notifImportant">중요 공시/뉴스</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">SNS 설정</label>
                            <div class="checkbox-item">
                                <input type="checkbox" id="snsAutoFollow" checked>
                                <label for="snsAutoFollow">새 팔로워 자동 맞팔로우</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="snsEmailNotif">
                                <label for="snsEmailNotif">중요 소식 이메일 알림</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button class="btn btn-secondary">로그아웃</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Tab Navigation (Updated to 5 tabs) -->
    <div class="bottom-tab-bar">
        <button class="tab-item active" onclick="switchTab('dashboard')">
            <div class="tab-icon">🏠</div>
            <div>홈</div>
        </button>
        <button class="tab-item" onclick="switchTab('sns')">
            <div class="tab-icon">💬</div>
            <div>SNS</div>
            <div class="tab-badge" id="snsBadge" style="display: none;">3</div>
        </button>
        <button class="tab-item" onclick="switchTab('timeline')">
            <div class="tab-icon">📰</div>
            <div>뉴스</div>
        </button>
        <button class="tab-item" onclick="switchTab('notes')">
            <div class="tab-icon">📝</div>
            <div>노트</div>
            <div class="tab-badge" id="notesBadge" style="display: none;">12</div>
        </button>
        <button class="tab-item" onclick="switchTab('profile')">
            <div class="tab-icon">👤</div>
            <div>프로필</div>
            <div class="tab-badge" id="notificationBadge">7</div>
        </button>
    </div>

    <!-- Modals -->
    <!-- Profile Edit Modal -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">프로필 수정</h3>
                <button class="modal-close" onclick="closeModal('editProfileModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">이름</label>
                    <input type="text" class="form-input" id="editName" value="김투자">
                </div>
                <div class="form-group">
                    <label class="form-label">소개</label>
                    <textarea class="form-textarea" id="editBio">10년차 개미투자자, 장기투자 선호</textarea>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="saveProfile()">저장</button>
                    <button class="btn btn-secondary" onclick="closeModal('editProfileModal')">취소</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add to Portfolio Modal -->
    <div id="addPortfolioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">포트폴리오에 종목 추가</h3>
                <button class="modal-close" onclick="closeModal('addPortfolioModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">종목</label>
                    <select class="form-select" id="addStockSelect">
                        <option value="">종목 선택...</option>
                        <option value="005930:삼성전자:korean">삼성전자 (005930)</option>
                        <option value="000660:SK하이닉스:korean">SK하이닉스 (000660)</option>
                        <option value="AAPL:Apple:us">Apple (AAPL)</option>
                        <option value="TSLA:Tesla:us">Tesla (TSLA)</option>
                        <option value="BTC:Bitcoin:crypto">Bitcoin (BTC)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">수량</label>
                    <input type="number" class="form-input" id="addQuantity" placeholder="보유 수량">
                </div>
                <div class="form-group">
                    <label class="form-label">평균 매수가</label>
                    <input type="number" class="form-input" id="addAvgPrice" placeholder="평균 매수가">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="saveToPortfolio()">추가</button>
                    <button class="btn btn-secondary" onclick="closeModal('addPortfolioModal')">취소</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🔔 알림</h3>
                <button class="modal-close" onclick="closeModal('notificationsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="allNotifications">
                    <!-- All notifications will be populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Note Modal -->
    <div id="editNoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">노트 수정</h3>
                <button class="modal-close" onclick="closeModal('editNoteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">제목</label>
                    <input type="text" id="editNoteTitle" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">내용</label>
                    <textarea id="editNoteContent" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">폴더</label>
                    <select id="editNoteFolder" class="form-select">
                        <option value="">폴더 선택</option>
                        <option value="투자아이디어">투자아이디어</option>
                        <option value="종목분석">종목분석</option>
                        <option value="뉴스">뉴스</option>
                        <option value="공시">공시</option>
                        <option value="외부링크">외부링크</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">태그</label>
                    <input type="text" id="editNoteTags" class="form-input" placeholder="태그를 쉼표로 구분">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="updateNote()">저장</button>
                    <button class="btn btn-secondary" onclick="closeModal('editNoteModal')">취소</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Stock data by market
        const STOCK_DATA = {
            korean: [
                { name: '삼성전자', code: '005930', market: 'korean' },
                { name: 'SK하이닉스', code: '000660', market: 'korean' },
                { name: 'LG에너지솔루션', code: '373220', market: 'korean' },
                { name: '삼성바이오로직스', code: '207940', market: 'korean' },
                { name: 'NAVER', code: '035420', market: 'korean' },
                { name: '카카오', code: '035720', market: 'korean' },
                { name: '현대차', code: '005380', market: 'korean' },
                { name: 'LG화학', code: '051910', market: 'korean' },
                { name: '셀트리온', code: '068270', market: 'korean' },
                { name: '기아', code: '000270', market: 'korean' }
            ],
            us: [
                { name: 'Apple', code: 'AAPL', market: 'us' },
                { name: 'Microsoft', code: 'MSFT', market: 'us' },
                { name: 'NVIDIA', code: 'NVDA', market: 'us' },
                { name: 'Tesla', code: 'TSLA', market: 'us' },
                { name: 'Alphabet', code: 'GOOGL', market: 'us' },
                { name: 'Amazon', code: 'AMZN', market: 'us' },
                { name: 'Meta', code: 'META', market: 'us' },
                { name: 'Netflix', code: 'NFLX', market: 'us' }
            ],
            crypto: [
                { name: 'Bitcoin', code: 'BTC', market: 'crypto' },
                { name: 'Ethereum', code: 'ETH', market: 'crypto' },
                { name: 'XRP', code: 'XRP', market: 'crypto' },
                { name: 'Solana', code: 'SOL', market: 'crypto' },
                { name: 'Dogecoin', code: 'DOGE', market: 'crypto' }
            ]
        };

        // Global state
        let currentTab = 'dashboard';
        let currentFilter = 'all';
        let currentSearch = '';
        let currentPage = 1;
        let hasMore = true;
        let isLoading = false;
        let selectedStocks = [];
        let selectedPeriod = 'today';
        let customDateRange = { start: null, end: null };
        let selectedMarkets = ['korean', 'us', 'crypto'];
        
        // NEW: SNS, Notes state (메모+스크랩 통합)
        let currentMemoType = 'free';
        let selectedMemoStock = null;
        let editingNoteId = null;

        // DOM elements
        const timelineEl = document.getElementById('timeline');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const loadMoreBtn = document.getElementById('loadMore');
        const searchInput = document.getElementById('searchInput');
        const stockSearch = document.getElementById('stockSearch');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');
        const selectedStocksEl = document.getElementById('selectedStocks');
        const filterToggleBtn = document.getElementById('filterToggleBtn');
        const advancedFilters = document.getElementById('advancedFilters');
        const filterCountBadge = document.getElementById('filterCountBadge');

        // Data management functions
        function loadFromStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Error loading from storage:', e);
                return defaultValue;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Error saving to storage:', e);
            }
        }

        // Tab management
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab items
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab content
            const targetTab = tabName === 'timeline' ? 'timeline-tab' : tabName;
            const tabContent = document.getElementById(targetTab);
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // Add active class to corresponding tab item
            const tabItems = document.querySelectorAll('.tab-item');
            const tabIndex = ['dashboard', 'sns', 'timeline', 'notes', 'profile'].indexOf(tabName);
            if (tabIndex >= 0 && tabItems[tabIndex]) {
                tabItems[tabIndex].classList.add('active');
            }
            
            currentTab = tabName;
            
            // Load content based on tab
            switch (tabName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'sns':
                    loadSNSFeed();
                    break;
                case 'timeline':
                    if (timelineEl && timelineEl.innerHTML === '') {
                        setupTimelineEventListeners();
                        loadFilings(true);
                    }
                    break;
                case 'notes':
                    loadNotes();
                    setupNotesEventListeners();
                    break;
                case 'profile':
                    loadProfileData();
                    break;
            }
        }

        // Initialize dummy data
        function initializeDummyData() {
            // Portfolio data
            const defaultPortfolio = [
                { ticker: '005930', name: '삼성전자', market: 'korean', quantity: 20, avgPrice: 75000 },
                { ticker: 'AAPL', name: 'Apple', market: 'us', quantity: 5, avgPrice: 180.00 },
                { ticker: 'BTC', name: 'Bitcoin', market: 'crypto', quantity: 0.1, avgPrice: 65000 }
            ];
            
            if (!localStorage.getItem('portfolio')) {
                saveToStorage('portfolio', defaultPortfolio);
            }

            // Notes data (메모+스크랩 통합)
            const defaultNotes = [
                // Memo type notes
                {
                    id: 'n1',
                    type: 'memo',
                    noteType: 'stock',
                    stock: { name: '삼성전자', code: '005930', market: 'korean' },
                    title: '삼성전자 투자 검토',
                    content: '3분기 실적 발표 후 주가가 조정받고 있지만, HBM3 매출 증가로 4분기부터 실적 개선 예상. 현재가는 매수 기회.',
                    folder: '종목분석',
                    tags: ['삼성전자', 'HBM3', '매수기회'],
                    createdAt: new Date(Date.now() - 86400000 * 1).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 1).toISOString()
                },
                {
                    id: 'n2',
                    type: 'memo',
                    noteType: 'free',
                    title: '2024년 포트폴리오 전략',
                    content: '올해 포트폴리오 전략: AI 관련주 비중 확대, 2차전지 선별 투자, 배당주 안정성 확보. 목표 수익률 15%.',
                    folder: '투자아이디어',
                    tags: ['포트폴리오', '전략', '2024'],
                    createdAt: new Date(Date.now() - 86400000 * 3).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 3).toISOString()
                },
                // Scrap type notes
                {
                    id: 'n3',
                    type: 'scrap',
                    title: '삼성전자 3Q 실적 분석 리포트',
                    url: 'https://example.com/samsung-q3-report',
                    content: '3분기 실적이 예상보다 좋았음. 4분기 전망도 긍정적이고, 특히 HBM 부문에서의 성장이 주목할 만함.',
                    folder: '뉴스',
                    tags: ['삼성전자', '실적', '분석'],
                    createdAt: new Date(Date.now() - 86400000 * 2).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 2).toISOString()
                },
                {
                    id: 'n4',
                    type: 'scrap',
                    title: 'Apple Q4 2024 Earnings Report',
                    url: 'https://example.com/apple-q4-earnings',
                    content: 'iPhone 15 판매량이 예상치를 상회했고, 서비스 부문 매출도 크게 증가. 2025년 전망도 밝음.',
                    folder: '외부링크',
                    tags: ['Apple', 'earnings', 'iPhone'],
                    createdAt: new Date(Date.now() - 86400000 * 4).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 4).toISOString()
                },
                // Timeline bookmark (news/filing scraps)
                {
                    id: 'n5',
                    type: 'news',
                    title: '비트코인 ETF 승인 소식',
                    url: '#',
                    content: '타임라인에서 북마크함',
                    folder: '뉴스',
                    tags: ['비트코인', 'ETF'],
                    createdAt: new Date(Date.now() - 86400000 * 5).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 5).toISOString()
                },
                {
                    id: 'n6',
                    type: 'filing',
                    title: 'SK하이닉스 투자계획 공시',
                    url: 'https://dart.fss.or.kr',
                    content: '타임라인에서 북마크함',
                    folder: '공시',
                    tags: ['SK하이닉스', '투자계획'],
                    createdAt: new Date(Date.now() - 86400000 * 6).toISOString(),
                    updatedAt: new Date(Date.now() - 86400000 * 6).toISOString()
                }
            ];

            if (!localStorage.getItem('notes')) {
                saveToStorage('notes', defaultNotes);
            }

            // SNS Posts data (NEW)
            const defaultSNSPosts = [
                {
                    id: 'sns1',
                    author: '김투자',
                    authorId: 'user_me',
                    avatar: '김',
                    content: '삼성전자 실적 발표 보고 추가 매수 결정했습니다. HBM 시장에서 점유율이 계속 늘어날 것 같아요. 여러분은 어떻게 보시나요?',
                    stockTags: ['삼성전자'],
                    imageUrl: null,
                    likes: 12,
                    comments: [
                        { author: '워렌버핏코리아', avatar: '워', content: '좋은 판단이네요!', time: '5분 전' },
                        { author: '테크투자왕', avatar: '테', content: 'HBM 수요는 계속 늘어날 것 같습니다', time: '3분 전' }
                    ],
                    createdAt: new Date(Date.now() - 3600000 * 2).toISOString(),
                    liked: false,
                    scrapped: false
                },
                {
                    id: 'sns2',
                    author: '워렌버핏코리아',
                    authorId: 'user_warren',
                    avatar: '워',
                    content: 'NVDA가 또 조정받고 있네요. 하지만 AI 혁명은 이제 시작일 뿐입니다. 장기 관점에서 보면...',
                    stockTags: ['NVDA'],
                    imageUrl: null,
                    likes: 28,
                    comments: [
                        { author: '김투자', avatar: '김', content: '동감합니다. 저도 추가 매수 고려 중', time: '1시간 전' }
                    ],
                    createdAt: new Date(Date.now() - 3600000 * 4).toISOString(),
                    liked: true,
                    scrapped: false
                },
                {
                    id: 'sns3',
                    author: '코인마스터',
                    authorId: 'user_coin',
                    avatar: '코',
                    content: '🎉 비트코인 10만 달러 돌파 축하합니다! 이제 다음 목표는 12만 달러. 기관 자금 유입이 본격화되고 있어요.',
                    stockTags: ['BTC'],
                    imageUrl: null,
                    likes: 45,
                    comments: [
                        { author: '김투자', avatar: '김', content: '정말 대단해요!', time: '30분 전' },
                        { author: '워렌버핏코리아', avatar: '워', content: '저는 아직 현금 비중을 늘리고 있습니다', time: '25분 전' }
                    ],
                    createdAt: new Date(Date.now() - 3600000 * 6).toISOString(),
                    liked: false,
                    scrapped: true
                },
                {
                    id: 'sns4',
                    author: '테크투자왕',
                    authorId: 'user_tech',
                    avatar: '테',
                    content: 'Tesla 로보택시 사업이 생각보다 빨리 상용화될 것 같습니다. FSD 기술이 상당한 수준에 도달했어요.',
                    stockTags: ['TSLA'],
                    imageUrl: 'https://via.placeholder.com/500x300/667eea/ffffff?text=Tesla+Robotaxi',
                    likes: 19,
                    comments: [],
                    createdAt: new Date(Date.now() - 3600000 * 8).toISOString(),
                    liked: false,
                    scrapped: false
                },
                // Scrap Share Post Example
                {
                    id: 'sns5',
                    author: '김투자',
                    authorId: 'user_me',
                    avatar: '김',
                    content: '유용한 분석 자료 공유합니다.',
                    isScrapShare: true,
                    scrapData: {
                        title: '삼성전자 목표주가 상향 조정 리포트',
                        url: 'https://example.com/samsung-report',
                        description: '증권사에서 삼성전자 목표주가를 기존 8만원에서 9만원으로 상향 조정'
                    },
                    stockTags: ['삼성전자'],
                    likes: 8,
                    comments: [
                        { author: '워렌버핏코리아', avatar: '워', content: '감사합니다!', time: '10분 전' }
                    ],
                    createdAt: new Date(Date.now() - 3600000 * 12).toISOString(),
                    liked: false,
                    scrapped: false
                }
            ];

            if (!localStorage.getItem('snsPosts')) {
                saveToStorage('snsPosts', defaultSNSPosts);
            }

            // Following users
            const defaultFollowing = [
                { userId: 'user_warren', name: '워렌버핏코리아', avatar: '워', bio: '가치투자 전문, 20년 경력', following: true },
                { userId: 'user_tech', name: '테크투자왕', avatar: '테', bio: '미국 기술주 전문', following: true },
                { userId: 'user_coin', name: '코인마스터', avatar: '코', bio: '암호화폐 분석가', following: true }
            ];

            if (!localStorage.getItem('following')) {
                saveToStorage('following', defaultFollowing);
            }

            // Notifications
            const defaultNotifications = [
                { id: 'n1', type: 'like', text: '워렌버핏코리아님이 회원님의 글을 좋아합니다', time: '5분 전' },
                { id: 'n2', type: 'comment', text: '테크투자왕님이 댓글을 남겼습니다', time: '1시간 전' },
                { id: 'n3', type: 'follow', text: '새로운 사용자가 팔로우를 시작했습니다', time: '3시간 전' }
            ];
            
            if (!localStorage.getItem('notifications')) {
                saveToStorage('notifications', defaultNotifications);
            }
        }

        // Dashboard functions
        function loadDashboardData() {
            loadPortfolioSummary();
            loadSNSFeedPreview();
            loadFilteredFeed();
            loadNotifications();
            loadRecentNotes();
        }

        function loadPortfolioSummary() {
            const portfolio = loadFromStorage('portfolio');
            const holdingsList = document.getElementById('holdingsList');
            
            if (portfolio.length === 0) {
                holdingsList.innerHTML = '<div class="empty-state">포트폴리오가 비어있습니다</div>';
                return;
            }
            
            const html = portfolio.slice(0, 3).map(holding => {
                const currentPrice = holding.avgPrice * (0.95 + Math.random() * 0.15);
                const pnl = (currentPrice - holding.avgPrice) / holding.avgPrice * 100;
                const pnlClass = pnl >= 0 ? 'positive' : 'negative';
                const pnlSign = pnl >= 0 ? '+' : '';
                
                return `
                    <div class="holding-item">
                        <div class="holding-info">
                            <div class="holding-name">${holding.name}</div>
                            <div class="holding-details">${holding.quantity}주 • 평균 ${holding.avgPrice.toLocaleString()}원</div>
                        </div>
                        <div class="holding-pnl ${pnlClass}">
                            ${pnlSign}${pnl.toFixed(1)}%
                        </div>
                    </div>
                `;
            }).join('');
            
            holdingsList.innerHTML = html;
        }

        function loadSNSFeedPreview() {
            const posts = loadFromStorage('snsPosts');
            const container = document.getElementById('snsFeedPreview');
            
            const following = loadFromStorage('following');
            const followingIds = following.map(u => u.userId);
            followingIds.push('user_me'); // Include my posts

            const followingPosts = posts.filter(post => followingIds.includes(post.authorId));
            
            const html = followingPosts.slice(0, 2).map(post => `
                <div class="feed-item">
                    <div class="feed-item-header">
                        <div class="profile-avatar">${post.avatar}</div>
                        <div class="feed-item-info">
                            <div class="feed-item-author">${post.author}</div>
                            <div class="feed-item-time">${new Date(post.createdAt).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="feed-item-content">
                        ${post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content}
                    </div>
                    <div class="feed-item-actions">
                        <button class="feed-action">❤️ ${post.likes}</button>
                        <button class="feed-action">💬 ${post.comments.length}</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function loadFilteredFeed() {
            const container = document.getElementById('filteredFeed');
            
            // Dummy filtered news/filings
            const dummyFeed = [
                { type: 'filing', title: '삼성전자', subtitle: '3분기 실적공시', icon: '📋', time: '10:30' },
                { type: 'news', title: 'Apple 신제품 발표', subtitle: '새로운 iPhone 공개', icon: '📰', time: '09:15' },
                { type: 'news', title: '비트코인 10만 달러', subtitle: '사상 최고가 경신', icon: '📰', time: '08:45' }
            ];
            
            const html = dummyFeed.map(item => `
                <div class="feed-item">
                    <div class="feed-item-header">
                        <div class="filing-icon">${item.icon}</div>
                        <div class="feed-item-info">
                            <div class="feed-item-author">${item.title}</div>
                            <div class="feed-item-time">${item.time}</div>
                        </div>
                    </div>
                    <div class="feed-item-content">${item.subtitle}</div>
                    <div class="feed-item-actions">
                        <button class="feed-action">🔖</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function loadNotifications() {
            const notifications = loadFromStorage('notifications');
            const container = document.getElementById('notificationsList');
            
            const html = notifications.slice(0, 3).map(notif => {
                let iconClass = 'notification-icon ';
                let icon = '';
                
                switch (notif.type) {
                    case 'like': iconClass += 'like'; icon = '❤️'; break;
                    case 'comment': iconClass += 'comment'; icon = '💬'; break;
                    case 'follow': iconClass += 'follow'; icon = '👤'; break;
                }
                
                return `
                    <div class="notification-item">
                        <div class="${iconClass}">${icon}</div>
                        <div class="notification-content">
                            <div class="notification-text">${notif.text}</div>
                            <div class="notification-time">${notif.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function loadRecentNotes() {
            const notes = loadFromStorage('notes');
            const container = document.getElementById('recentNotes');
            
            const html = notes.slice(0, 3).map(note => {
                let icon = '📝';
                let typeLabel = '메모';
                
                if (note.type === 'scrap') {
                    icon = '🔗';
                    typeLabel = '스크랩';
                } else if (note.type === 'news') {
                    icon = '📰';
                    typeLabel = '뉴스';
                } else if (note.type === 'filing') {
                    icon = '📋';
                    typeLabel = '공시';
                } else if (note.type === 'memo') {
                    icon = '✍️';
                    typeLabel = '메모';
                }
                
                return `
                    <div class="feed-item">
                        <div class="feed-item-header">
                            <div class="filing-icon">${icon}</div>
                            <div class="feed-item-info">
                                <div class="feed-item-author">${note.title}</div>
                                <div class="feed-item-time">${typeLabel} • ${new Date(note.createdAt).toLocaleDateString()}</div>
                            </div>
                        </div>
                        <div class="feed-item-content">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            
            // Update badge
            const badge = document.getElementById('notesBadge');
            if (badge && notes.length > 0) {
                badge.textContent = notes.length;
                badge.style.display = 'flex';
            }
        }

        // SNS Feed functions (NEW)
        function loadSNSFeed() {
            const posts = loadFromStorage('snsPosts');
            const container = document.getElementById('snsFeedList');
            const emptyState = document.getElementById('snsEmpty');
            
            if (posts.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Sort posts by date (newest first)
            posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            const html = posts.map(post => renderSNSPost(post)).join('');
            container.innerHTML = html;
            
            // Update SNS badge
            const badge = document.getElementById('snsBadge');
            const myPosts = posts.filter(p => p.authorId === 'user_me');
            if (myPosts.length > 0) {
                badge.textContent = myPosts.length;
                badge.style.display = 'flex';
            }
        }

        function renderSNSPost(post) {
            const timeAgo = getTimeAgo(post.createdAt);
            
            let contentHtml = `<div class="sns-post-content">${post.content}</div>`;
            
            // Scrap share post
            if (post.isScrapShare && post.scrapData) {
                contentHtml += `
                    <div class="sns-scrap-share">
                        <div class="sns-scrap-header">
                            🔗 ${post.author}님이 스크랩을 공유했습니다
                        </div>
                        <a href="${post.scrapData.url}" target="_blank" class="sns-link-card">
                            <div class="sns-link-title">${post.scrapData.title}</div>
                            ${post.scrapData.description ? `<div class="sns-link-description">${post.scrapData.description}</div>` : ''}
                            <div class="sns-link-url">${post.scrapData.url}</div>
                        </a>
                    </div>
                `;
            }
            
            // Image
            if (post.imageUrl) {
                contentHtml += `<div class="sns-post-image"><img src="${post.imageUrl}" alt="Post image"></div>`;
            }
            
            // Stock tags
            if (post.stockTags && post.stockTags.length > 0) {
                contentHtml += `
                    <div class="sns-post-tags">
                        ${post.stockTags.map(tag => `<div class="sns-stock-tag">${tag}</div>`).join('')}
                    </div>
                `;
            }
            
            return `
                <div class="sns-post" data-post-id="${post.id}">
                    <div class="sns-post-header">
                        <div class="sns-author-avatar">${post.avatar}</div>
                        <div class="sns-post-info">
                            <div class="sns-author-name">${post.author}</div>
                            <div class="sns-post-time">${timeAgo}</div>
                        </div>
                    </div>
                    ${contentHtml}
                    <div class="sns-post-actions">
                        <button class="sns-action-btn ${post.liked ? 'active' : ''}" onclick="toggleSNSLike('${post.id}')">
                            ❤️ ${post.likes}
                        </button>
                        <button class="sns-action-btn" onclick="toggleSNSComments('${post.id}')">
                            💬 ${post.comments.length}
                        </button>
                        <button class="sns-action-btn ${post.scrapped ? 'active' : ''}" onclick="toggleSNSScrap('${post.id}')">
                            🔖
                        </button>
                    </div>
                    <div class="sns-comments" id="comments-${post.id}">
                        ${post.comments.map(comment => `
                            <div class="sns-comment">
                                <div class="sns-comment-avatar">${comment.avatar}</div>
                                <div class="sns-comment-content">
                                    <div class="sns-comment-author">${comment.author}</div>
                                    <div class="sns-comment-text">${comment.content}</div>
                                    <div class="sns-comment-time">${comment.time}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function publishSNSPost() {
            const content = document.getElementById('snsPostContent').value.trim();
            if (!content) {
                alert('내용을 입력해주세요.');
                return;
            }
            
            const imageUrl = document.getElementById('snsImageUrl').value.trim();
            const stockTag = document.getElementById('snsStockTag').value.trim();
            
            const posts = loadFromStorage('snsPosts');
            const newPost = {
                id: 'sns' + Date.now(),
                author: '김투자',
                authorId: 'user_me',
                avatar: '김',
                content: content,
                stockTags: stockTag ? [stockTag] : [],
                imageUrl: imageUrl || null,
                likes: 0,
                comments: [],
                createdAt: new Date().toISOString(),
                liked: false,
                scrapped: false
            };
            
            posts.unshift(newPost);
            saveToStorage('snsPosts', posts);
            
            clearSNSCompose();
            loadSNSFeed();
            
            // Update dashboard if visible
            if (currentTab === 'dashboard') {
                loadSNSFeedPreview();
            }
            
            alert('글이 발행되었습니다!');
        }

        function clearSNSCompose() {
            document.getElementById('snsPostContent').value = '';
            document.getElementById('snsImageUrl').value = '';
            document.getElementById('snsStockTag').value = '';
        }

        function toggleSNSLike(postId) {
            const posts = loadFromStorage('snsPosts');
            const postIndex = posts.findIndex(p => p.id === postId);
            if (postIndex !== -1) {
                posts[postIndex].liked = !posts[postIndex].liked;
                posts[postIndex].likes += posts[postIndex].liked ? 1 : -1;
                saveToStorage('snsPosts', posts);
                loadSNSFeed();
            }
        }

        function toggleSNSComments(postId) {
            const commentsEl = document.getElementById(`comments-${postId}`);
            if (commentsEl) {
                commentsEl.classList.toggle('active');
            }
        }

        function toggleSNSScrap(postId) {
            const posts = loadFromStorage('snsPosts');
            const postIndex = posts.findIndex(p => p.id === postId);
            if (postIndex !== -1) {
                posts[postIndex].scrapped = !posts[postIndex].scrapped;
                saveToStorage('snsPosts', posts);
                
                if (posts[postIndex].scrapped) {
                    // Add to scraps
                    const scraps = loadFromStorage('scraps');
                    const newScrap = {
                        id: 's' + Date.now(),
                        title: `${posts[postIndex].author}님의 SNS 글`,
                        url: '#',
                        folder: 'SNS',
                        tags: posts[postIndex].stockTags || [],
                        note: posts[postIndex].content,
                        savedAt: new Date().toISOString()
                    };
                    scraps.unshift(newScrap);
                    saveToStorage('scraps', scraps);
                    
                    alert('스크랩에 저장되었습니다!');
                }
                
                loadSNSFeed();
            }
        }

        function getTimeAgo(dateStr) {
            const now = new Date();
            const date = new Date(dateStr);
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return '방금 전';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}분 전`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}시간 전`;
            return `${Math.floor(diffInSeconds / 86400)}일 전`;
        }

        // Notes functions (메모+스크랩 통합)
        function setupNotesEventListeners() {
            if (document.notesListenersSetup) return;
            document.notesListenersSetup = true;

            // Note creation type toggle
            document.querySelectorAll('.note-create-tab').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchNoteCreation(e.target.dataset.type);
                });
            });

            // Memo type toggle
            document.querySelectorAll('.memo-type-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.memo-type-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentMemoType = e.target.dataset.type;
                    
                    const stockSelect = document.getElementById('memoStockSelect');
                    if (currentMemoType === 'stock') {
                        stockSelect.classList.add('active');
                    } else {
                        stockSelect.classList.remove('active');
                        selectedMemoStock = null;
                        document.getElementById('selectedMemoStock').innerHTML = '';
                    }
                });
            });

            // Memo stock search
            const memoStockSearch = document.getElementById('memoStockSearch');
            if (memoStockSearch) {
                memoStockSearch.addEventListener('input', handleMemoStockSearch);
            }

            // Notes filters
            document.querySelectorAll('.notes-filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.notes-filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    loadNotes();
                });
            });

            // Folder filters
            document.querySelectorAll('.folder-filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.folder-filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    loadNotes();
                });
            });

            // Sort buttons
            document.querySelectorAll('[data-sort]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (e.target.closest('.notes')) {
                        document.querySelectorAll('[data-sort]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        loadNotes();
                    }
                });
            });

            // Notes search
            const notesSearchInput = document.getElementById('notesSearchInput');
            if (notesSearchInput) {
                notesSearchInput.addEventListener('input', (e) => {
                    loadNotes();
                });
            }
        }

        function switchNoteCreation(type) {
            document.querySelectorAll('.note-create-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            const memoForm = document.getElementById('memoForm');
            const scrapForm = document.getElementById('scrapForm');
            
            if (type === 'memo') {
                memoForm.style.display = 'block';
                scrapForm.style.display = 'none';
            } else {
                memoForm.style.display = 'none';
                scrapForm.style.display = 'block';
            }
        }

        function setupMemoEventListeners() {
            if (document.memoListenersSetup) return;
            document.memoListenersSetup = true;

            // Memo type toggle
            document.querySelectorAll('.memo-type-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.memo-type-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentMemoType = e.target.dataset.type;
                    
                    const stockSelect = document.getElementById('memoStockSelect');
                    if (currentMemoType === 'stock') {
                        stockSelect.classList.add('active');
                    } else {
                        stockSelect.classList.remove('active');
                        selectedMemoStock = null;
                        document.getElementById('selectedMemoStock').innerHTML = '';
                    }
                });
            });

            // Memo stock search
            const memoStockSearch = document.getElementById('memoStockSearch');
            if (memoStockSearch) {
                memoStockSearch.addEventListener('input', handleMemoStockSearch);
            }

            // Memo filters
            document.querySelectorAll('.memo-filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.memo-filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentMemoFilter = e.target.dataset.filter;
                    loadMemos();
                });
            });

            // Memo search
            const memoSearchInput = document.getElementById('memoSearchInput');
            if (memoSearchInput) {
                memoSearchInput.addEventListener('input', (e) => {
                    loadMemos(e.target.value);
                });
            }
        }

        function handleMemoStockSearch(e) {
            const query = e.target.value.toLowerCase();
            const dropdown = document.getElementById('memoAutocompleteDropdown');
            
            if (query.length < 1) {
                dropdown.style.display = 'none';
                return;
            }

            const availableStocks = getAvailableStocks();
            const matches = availableStocks.filter(stock => 
                stock.name.toLowerCase().includes(query) || 
                stock.code.toLowerCase().includes(query)
            ).slice(0, 10);

            if (matches.length > 0) {
                const html = matches.map(stock => 
                    `<div class="autocomplete-item" onclick="selectMemoStock('${stock.name}', '${stock.code}', '${stock.market}')">
                        <span>${stock.name}</span>
                        <span class="stock-code-small">${stock.code}</span>
                    </div>`
                ).join('');
                
                dropdown.innerHTML = html;
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }

        function selectMemoStock(name, code, market) {
            selectedMemoStock = { name, code, market };
            document.getElementById('memoStockSearch').value = '';
            document.getElementById('memoAutocompleteDropdown').style.display = 'none';
            
            const container = document.getElementById('selectedMemoStock');
            container.innerHTML = `
                <div class="stock-tag ${market}">
                    <span>${name} (${code})</span>
                    <button class="remove-btn" onclick="clearMemoStock()">×</button>
                </div>
            `;
        }

        function clearMemoStock() {
            selectedMemoStock = null;
            document.getElementById('selectedMemoStock').innerHTML = '';
        }

        function loadMemos(searchQuery = '') {
            const memos = loadFromStorage('memos');
            const container = document.getElementById('memoList');
            const emptyState = document.getElementById('memoEmpty');
            
            let filteredMemos = memos;
            
            if (currentMemoFilter === 'stock') {
                filteredMemos = filteredMemos.filter(memo => memo.type === 'stock');
            } else if (currentMemoFilter === 'free') {
                filteredMemos = filteredMemos.filter(memo => memo.type === 'free');
            }
            
            if (searchQuery) {
                filteredMemos = filteredMemos.filter(memo => 
                    memo.content.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (memo.stock && memo.stock.name.toLowerCase().includes(searchQuery.toLowerCase()))
                );
            }
            
            filteredMemos.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredMemos.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const html = filteredMemos.map(memo => `
                <div class="memo-item">
                    <div class="memo-header">
                        <div class="memo-meta">
                            <div class="memo-date">${new Date(memo.createdAt).toLocaleDateString()}</div>
                            ${memo.type === 'stock' ? `<div class="memo-tag">${memo.stock.name}</div>` : ''}
                        </div>
                        <div class="memo-actions">
                            <button class="memo-action-btn" onclick="editMemo('${memo.id}')">수정</button>
                            <button class="memo-action-btn" onclick="deleteMemo('${memo.id}')">삭제</button>
                        </div>
                    </div>
                    <div class="memo-content">${memo.content}</div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function loadNotes() {
            const notes = loadFromStorage('notes');
            const container = document.getElementById('notesList');
            const emptyState = document.getElementById('notesEmpty');
            
            // Get current filters
            const activeFilter = document.querySelector('.notes-filter-btn.active')?.dataset.filter || 'all';
            const activeFolder = document.querySelector('.folder-filter-btn.active')?.dataset.folder || '';
            const searchQuery = document.getElementById('notesSearchInput')?.value.toLowerCase() || '';
            const sortOrder = document.querySelector('[data-sort].active')?.dataset.sort || 'newest';
            
            let filteredNotes = notes;
            
            // Apply type filter
            if (activeFilter !== 'all') {
                filteredNotes = filteredNotes.filter(note => note.type === activeFilter);
            }
            
            // Apply folder filter
            if (activeFolder) {
                filteredNotes = filteredNotes.filter(note => note.folder === activeFolder);
            }
            
            // Apply search filter
            if (searchQuery) {
                filteredNotes = filteredNotes.filter(note => 
                    note.title.toLowerCase().includes(searchQuery) ||
                    note.content.toLowerCase().includes(searchQuery) ||
                    (note.tags && note.tags.some(tag => tag.toLowerCase().includes(searchQuery)))
                );
            }
            
            // Apply sort
            if (sortOrder === 'newest') {
                filteredNotes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            } else {
                filteredNotes.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
            }
            
            if (filteredNotes.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const html = filteredNotes.map(note => renderNoteItem(note)).join('');
            container.innerHTML = html;
        }

        function renderNoteItem(note) {
            let icon = '📝';
            let typeLabel = '메모';
            
            if (note.type === 'scrap') {
                icon = '🔗';
                typeLabel = '스크랩';
            } else if (note.type === 'news') {
                icon = '📰';
                typeLabel = '뉴스 스크랩';
            } else if (note.type === 'filing') {
                icon = '📋';
                typeLabel = '공시 스크랩';
            } else if (note.type === 'memo') {
                icon = '✍️';
                typeLabel = '메모';
            }
            
            return `
                <div class="note-item">
                    <div class="note-item-header">
                        <div class="note-item-info">
                            <div class="note-item-type">
                                <span class="note-type-icon">${icon}</span>
                                <span class="note-type-label">${typeLabel}</span>
                            </div>
                            <div class="note-item-title">${note.title}</div>
                            <div class="note-item-meta">
                                <span class="note-date">${new Date(note.createdAt).toLocaleDateString()}</span>
                                ${note.folder ? `<span class="note-folder">${note.folder}</span>` : ''}
                                ${note.tags ? note.tags.map(tag => `<span class="note-tag">${tag}</span>`).join('') : ''}
                            </div>
                        </div>
                        <div class="note-item-actions">
                            <button class="note-action-btn" onclick="editNote('${note.id}')">수정</button>
                            <button class="note-action-btn" onclick="deleteNote('${note.id}')">삭제</button>
                            ${note.url ? `<a href="${note.url}" target="_blank" class="note-action-btn" style="text-decoration: none; color: inherit;">열기</a>` : ''}
                        </div>
                    </div>
                    <div class="note-item-content">${note.content}</div>
                    ${note.url ? `
                        <div class="note-link-card">
                            <div class="note-link-title">${note.title}</div>
                            <div class="note-link-url">${note.url}</div>
                        </div>
                    ` : ''}
                    <div class="note-sns-share">
                        <input type="checkbox" id="share-${note.id}">
                        <label for="share-${note.id}">SNS에 공유하기</label>
                    </div>
                </div>
            `;
        }

        function saveMemo() {
            const content = document.getElementById('memoContent').value.trim();
            if (!content) {
                alert('메모 내용을 입력해주세요.');
                return;
            }
            
            if (currentMemoType === 'stock' && !selectedMemoStock) {
                alert('종목을 선택해주세요.');
                return;
            }
            
            const notes = loadFromStorage('notes');
            const folder = document.getElementById('memoFolder').value;
            
            let title;
            if (currentMemoType === 'stock' && selectedMemoStock) {
                title = `${selectedMemoStock.name} 투자 메모`;
            } else {
                title = content.substring(0, 30) + (content.length > 30 ? '...' : '');
            }
            
            const newNote = {
                id: 'n' + Date.now(),
                type: 'memo',
                noteType: currentMemoType,
                stock: selectedMemoStock,
                title: title,
                content: content,
                folder: folder || '개인기록',
                tags: selectedMemoStock ? [selectedMemoStock.name] : [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            notes.unshift(newNote);
            saveToStorage('notes', notes);

            // SNS 공유 체크박스 확인
            if (document.getElementById('memoToSNS').checked) {
                const posts = loadFromStorage('snsPosts');
                const snsPost = {
                    id: 'sns' + Date.now(),
                    author: '김투자',
                    authorId: 'user_me',
                    avatar: '김',
                    content: content,
                    stockTags: selectedMemoStock ? [selectedMemoStock.name] : [],
                    imageUrl: null,
                    likes: 0,
                    comments: [],
                    createdAt: new Date().toISOString(),
                    liked: false,
                    scrapped: false
                };
                posts.unshift(snsPost);
                saveToStorage('snsPosts', posts);
            }
            
            clearNoteForm();
            loadNotes();
            
            if (currentTab === 'dashboard') {
                loadRecentNotes();
            }
            
            alert('메모가 저장되었습니다!');
        }

        function clearMemoForm() {
            document.getElementById('memoContent').value = '';
            document.getElementById('memoToSNS').checked = false;
            selectedMemoStock = null;
            document.getElementById('selectedMemoStock').innerHTML = '';
        }

        function editMemo(memoId) {
            const memos = loadFromStorage('memos');
            const memo = memos.find(m => m.id === memoId);
            if (!memo) return;
            
            editingMemoId = memoId;
            document.getElementById('editMemoContent').value = memo.content;
            document.getElementById('editMemoModal').classList.add('active');
        }

        function updateMemo() {
            const content = document.getElementById('editMemoContent').value.trim();
            if (!content) {
                alert('메모 내용을 입력해주세요.');
                return;
            }
            
            const memos = loadFromStorage('memos');
            const memoIndex = memos.findIndex(m => m.id === editingMemoId);
            if (memoIndex !== -1) {
                memos[memoIndex].content = content;
                memos[memoIndex].updatedAt = new Date().toISOString();
                saveToStorage('memos', memos);
                
                loadMemos();
                closeModal('editMemoModal');
                alert('메모가 수정되었습니다!');
            }
        }

        function deleteMemo(memoId) {
            if (!confirm('정말로 이 메모를 삭제하시겠습니까?')) return;
            
            const memos = loadFromStorage('memos');
            const filtered = memos.filter(m => m.id !== memoId);
            saveToStorage('memos', filtered);
            
            loadMemos();
            
            if (currentTab === 'dashboard') {
                loadRecentMemos();
            }
            
            alert('메모가 삭제되었습니다.');
        }

        // Scrap functions
        function setupScrapEventListeners() {
            if (document.scrapListenersSetup) return;
            document.scrapListenersSetup = true;

            // Folder tabs
            document.querySelectorAll('.folder-tab').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.folder-tab').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentScrapFolder = e.target.dataset.folder;
                    loadScraps();
                });
            });

            // Sort buttons
            document.querySelectorAll('[data-sort]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('[data-sort]').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentScrapSort = e.target.dataset.sort;
                    loadScraps();
                });
            });

            // Scrap search
            const scrapSearchInput = document.getElementById('scrapSearchInput');
            if (scrapSearchInput) {
                scrapSearchInput.addEventListener('input', (e) => {
                    loadScraps(e.target.value);
                });
            }
        }

        function previewUrl() {
            const url = document.getElementById('scrapUrl').value.trim();
            const previewCard = document.getElementById('urlPreviewCard');
            const titleInput = document.getElementById('scrapTitle');
            
            if (!url) {
                previewCard.classList.remove('active');
                return;
            }
            
            // URL 미리보기 더미 데이터 (실제로는 API 호출)
            let title = '링크 제목';
            let description = '링크 설명';
            
            if (url.includes('samsung') || url.includes('005930')) {
                title = '삼성전자 3분기 실적 발표 자료';
                description = '삼성전자 2024년 3분기 실적이 시장 예상치를 상회하며...';
            } else if (url.includes('apple') || url.includes('AAPL')) {
                title = 'Apple Q4 2024 Earnings Report';
                description = 'Apple reports record quarterly revenue driven by iPhone 15 sales...';
            } else if (url.includes('bitcoin') || url.includes('BTC')) {
                title = '비트코인 10만 달러 돌파 분석';
                description = '비트코인이 사상 최초로 10만 달러를 돌파하면서...';
            }
            
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewDescription').textContent = description;
            
            if (!titleInput.value.trim()) {
                titleInput.value = title;
            }
            
            previewCard.classList.add('active');
        }

        function loadScraps(searchQuery = '') {
            const scraps = loadFromStorage('scraps');
            const container = document.getElementById('scrapList');
            const emptyState = document.getElementById('scrapEmpty');
            
            let filteredScraps = scraps;
            
            if (currentScrapFolder !== '전체') {
                filteredScraps = filteredScraps.filter(scrap => scrap.folder === currentScrapFolder);
            }
            
            if (searchQuery) {
                filteredScraps = filteredScraps.filter(scrap => 
                    scrap.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    scrap.note.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (scrap.tags && scrap.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase())))
                );
            }
            
            if (currentScrapSort === 'newest') {
                filteredScraps.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            } else {
                filteredScraps.sort((a, b) => new Date(a.savedAt) - new Date(b.savedAt));
            }
            
            if (filteredScraps.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const html = filteredScraps.map(scrap => `
                <div class="scrap-item">
                    <div class="scrap-header">
                        <div class="scrap-info">
                            <div class="scrap-title">${scrap.title}</div>
                            <div class="scrap-url">${scrap.url}</div>
                            <div class="scrap-meta">
                                <div class="scrap-date">${new Date(scrap.savedAt).toLocaleDateString()}</div>
                                <div class="scrap-folder">${scrap.folder}</div>
                                ${scrap.tags ? scrap.tags.map(tag => `<div class="scrap-tag">${tag}</div>`).join('') : ''}
                            </div>
                        </div>
                        <div class="scrap-actions">
                            <button class="scrap-action-btn" onclick="editScrap('${scrap.id}')">수정</button>
                            <button class="scrap-action-btn" onclick="deleteScrap('${scrap.id}')">삭제</button>
                            <a href="${scrap.url}" target="_blank" class="scrap-action-btn" style="text-decoration: none; color: inherit;">열기</a>
                        </div>
                    </div>
                    ${scrap.note ? `<div class="scrap-note">${scrap.note}</div>` : ''}
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function saveScrap() {
            const url = document.getElementById('scrapUrl').value.trim();
            const title = document.getElementById('scrapTitle').value.trim();
            const folder = document.getElementById('scrapFolder').value;
            const tags = document.getElementById('scrapTags').value.trim();
            const note = document.getElementById('scrapNote').value.trim();
            
            if (!url || !title) {
                alert('URL과 제목을 입력해주세요.');
                return;
            }
            
            const notes = loadFromStorage('notes');
            const newNote = {
                id: 'n' + Date.now(),
                type: 'scrap',
                title: title,
                url: url,
                content: note || '스크랩한 링크입니다.',
                folder: folder,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            notes.unshift(newNote);
            saveToStorage('notes', notes);

            // SNS 공유 체크박스 확인
            if (document.getElementById('scrapToSNS').checked) {
                const posts = loadFromStorage('snsPosts');
                const snsPost = {
                    id: 'sns' + Date.now(),
                    author: '김투자',
                    authorId: 'user_me',
                    avatar: '김',
                    content: note || '유용한 자료를 스크랩했습니다.',
                    isScrapShare: true,
                    scrapData: {
                        title: title,
                        url: url,
                        description: note
                    },
                    stockTags: tags ? tags.split(',').map(tag => tag.trim()).slice(0, 2) : [],
                    likes: 0,
                    comments: [],
                    createdAt: new Date().toISOString(),
                    liked: false,
                    scrapped: false
                };
                posts.unshift(snsPost);
                saveToStorage('snsPosts', posts);
            }
            
            clearNoteForm();
            loadNotes();
            
            if (currentTab === 'dashboard') {
                loadRecentNotes();
            }
            
            alert('스크랩이 저장되었습니다!');
        }

        function clearNoteForm() {
            // Clear memo form
            document.getElementById('memoContent').value = '';
            document.getElementById('memoFolder').value = '';
            document.getElementById('memoToSNS').checked = false;
            selectedMemoStock = null;
            document.getElementById('selectedMemoStock').innerHTML = '';
            
            // Clear scrap form
            document.getElementById('scrapUrl').value = '';
            document.getElementById('scrapTitle').value = '';
            document.getElementById('scrapFolder').value = '외부링크';
            document.getElementById('scrapTags').value = '';
            document.getElementById('scrapNote').value = '';
            document.getElementById('scrapToSNS').checked = false;
            document.getElementById('urlPreviewCard').classList.remove('active');
        }

        function editNote(noteId) {
            const notes = loadFromStorage('notes');
            const note = notes.find(n => n.id === noteId);
            if (!note) return;
            
            editingNoteId = noteId;
            document.getElementById('editNoteTitle').value = note.title;
            document.getElementById('editNoteContent').value = note.content;
            document.getElementById('editNoteFolder').value = note.folder || '';
            document.getElementById('editNoteTags').value = note.tags ? note.tags.join(', ') : '';
            document.getElementById('editNoteModal').classList.add('active');
        }

        function updateNote() {
            const title = document.getElementById('editNoteTitle').value.trim();
            const content = document.getElementById('editNoteContent').value.trim();
            const folder = document.getElementById('editNoteFolder').value;
            const tags = document.getElementById('editNoteTags').value.trim();
            
            if (!title || !content) {
                alert('제목과 내용을 입력해주세요.');
                return;
            }
            
            const notes = loadFromStorage('notes');
            const noteIndex = notes.findIndex(n => n.id === editingNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].title = title;
                notes[noteIndex].content = content;
                notes[noteIndex].folder = folder;
                notes[noteIndex].tags = tags ? tags.split(',').map(tag => tag.trim()) : [];
                notes[noteIndex].updatedAt = new Date().toISOString();
                saveToStorage('notes', notes);
                
                loadNotes();
                closeModal('editNoteModal');
                alert('노트가 수정되었습니다!');
            }
        }

        function deleteNote(noteId) {
            if (!confirm('정말로 이 노트를 삭제하시겠습니까?')) return;
            
            const notes = loadFromStorage('notes');
            const filtered = notes.filter(n => n.id !== noteId);
            saveToStorage('notes', filtered);
            
            loadNotes();
            
            if (currentTab === 'dashboard') {
                loadRecentNotes();
            }
            
            alert('노트가 삭제되었습니다.');
        }

        function clearScrapForm() {
            document.getElementById('scrapUrl').value = '';
            document.getElementById('scrapTitle').value = '';
            document.getElementById('scrapFolder').value = '전체';
            document.getElementById('scrapTags').value = '';
            document.getElementById('scrapNote').value = '';
            document.getElementById('scrapToSNS').checked = false;
            document.getElementById('urlPreviewCard').classList.remove('active');
        }

        function editScrap(scrapId) {
            const scraps = loadFromStorage('scraps');
            const scrap = scraps.find(s => s.id === scrapId);
            if (!scrap) return;
            
            editingScrapId = scrapId;
            document.getElementById('editScrapTitle').value = scrap.title;
            document.getElementById('editScrapUrl').value = scrap.url;
            document.getElementById('editScrapFolder').value = scrap.folder;
            document.getElementById('editScrapTags').value = scrap.tags ? scrap.tags.join(', ') : '';
            document.getElementById('editScrapNote').value = scrap.note || '';
            document.getElementById('editScrapModal').classList.add('active');
        }

        function updateScrap() {
            const title = document.getElementById('editScrapTitle').value.trim();
            const url = document.getElementById('editScrapUrl').value.trim();
            const folder = document.getElementById('editScrapFolder').value;
            const tags = document.getElementById('editScrapTags').value.trim();
            const note = document.getElementById('editScrapNote').value.trim();
            
            if (!url || !title) {
                alert('URL과 제목을 입력해주세요.');
                return;
            }
            
            const scraps = loadFromStorage('scraps');
            const scrapIndex = scraps.findIndex(s => s.id === editingScrapId);
            if (scrapIndex !== -1) {
                scraps[scrapIndex].title = title;
                scraps[scrapIndex].url = url;
                scraps[scrapIndex].folder = folder;
                scraps[scrapIndex].tags = tags ? tags.split(',').map(tag => tag.trim()) : [];
                scraps[scrapIndex].note = note;
                saveToStorage('scraps', scraps);
                
                loadScraps();
                closeModal('editScrapModal');
                alert('스크랩이 수정되었습니다!');
            }
        }

        function deleteScrap(scrapId) {
            if (!confirm('정말로 이 스크랩을 삭제하시겠습니까?')) return;
            
            const scraps = loadFromStorage('scraps');
            const filtered = scraps.filter(s => s.id !== scrapId);
            saveToStorage('scraps', filtered);
            
            loadScraps();
            
            if (currentTab === 'dashboard') {
                loadRecentScraps();
            }
            
            alert('스크랩이 삭제되었습니다.');
        }

        // Profile functions
        function loadProfileData() {
            loadPortfolioManagement();
            loadFollowing();
        }

        function loadPortfolioManagement() {
            const portfolio = loadFromStorage('portfolio');
            const container = document.getElementById('portfolioManagement');
            
            const html = portfolio.map(holding => `
                <div class="portfolio-item">
                    <div class="portfolio-item-info">
                        <div class="portfolio-item-name">${holding.name} (${holding.ticker})</div>
                        <div class="portfolio-item-details">${holding.quantity}주 • 평균 ${holding.avgPrice.toLocaleString()}원</div>
                    </div>
                    <div class="portfolio-item-actions">
                        <button class="btn btn-secondary" onclick="editPortfolioItem('${holding.ticker}')">수정</button>
                        <button class="btn btn-danger" onclick="removePortfolioItem('${holding.ticker}')">삭제</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function removePortfolioItem(ticker) {
            const portfolio = loadFromStorage('portfolio');
            const filtered = portfolio.filter(item => item.ticker !== ticker);
            saveToStorage('portfolio', filtered);
            loadPortfolioManagement();
            
            if (currentTab === 'dashboard') {
                loadPortfolioSummary();
            }
        }

        function switchFollowingFilter(button) {
            document.querySelectorAll('[data-following-filter]').forEach(b => b.classList.remove('active'));
            button.classList.add('active');
            
            const filter = button.dataset.followingFilter;
            
            if (filter === 'following') {
                document.getElementById('followingList').style.display = 'block';
                document.getElementById('recommendedUsers').style.display = 'none';
                loadFollowingList();
            } else {
                document.getElementById('followingList').style.display = 'none';
                document.getElementById('recommendedUsers').style.display = 'block';
                loadRecommendedUsers();
            }
        }

        function loadFollowing() {
            loadFollowingList();
        }

        function loadFollowingList() {
            const following = loadFromStorage('following');
            const container = document.getElementById('followingList');
            const emptyState = document.getElementById('followingEmpty');
            
            if (following.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const html = following.map(user => `
                <div class="profile-card">
                    <div class="profile-large-avatar">${user.avatar}</div>
                    <div class="profile-info">
                        <div class="profile-name">${user.name}</div>
                        <div class="profile-bio">${user.bio}</div>
                        <div class="profile-stats">팔로워 ${Math.floor(Math.random() * 1000)}명</div>
                    </div>
                    <button class="follow-btn following" onclick="toggleFollow('${user.userId}')">팔로잉</button>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function loadRecommendedUsers() {
            const recommended = [
                { userId: 'u4', name: '배당킹', avatar: '배', bio: '배당주 투자 전문가', following: false },
                { userId: 'u5', name: 'ESG투자자', avatar: 'E', bio: 'ESG 투자 리서처', following: false },
                { userId: 'u6', name: '해외주식달인', avatar: '해', bio: '해외 주식 투자 10년차', following: false }
            ];
            
            const container = document.getElementById('recommendedUsers');
            
            const html = recommended.map(user => `
                <div class="profile-card">
                    <div class="profile-large-avatar">${user.avatar}</div>
                    <div class="profile-info">
                        <div class="profile-name">${user.name}</div>
                        <div class="profile-bio">${user.bio}</div>
                        <div class="profile-stats">팔로워 ${Math.floor(Math.random() * 1000)}명</div>
                    </div>
                    <button class="follow-btn" onclick="followRecommendedUser('${user.userId}', '${user.name}', '${user.avatar}', '${user.bio}')">팔로우</button>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function toggleFollow(userId) {
            const following = loadFromStorage('following');
            const userIndex = following.findIndex(u => u.userId === userId);
            
            if (userIndex !== -1) {
                following.splice(userIndex, 1);
                saveToStorage('following', following);
                loadFollowingList();
                alert('팔로우를 취소했습니다.');
            }
        }

        function followRecommendedUser(userId, name, avatar, bio) {
            const following = loadFromStorage('following');
            const newFollowing = {
                userId: userId,
                name: name,
                avatar: avatar,
                bio: bio,
                following: true
            };
            
            following.push(newFollowing);
            saveToStorage('following', following);
            
            alert(`${name}님을 팔로우했습니다!`);
        }

        // Timeline functions (basic version)
        function setupTimelineEventListeners() {
            if (document.timelineInitialized) return;
            document.timelineInitialized = true;
            
            // Filter toggle button
            if (filterToggleBtn) {
                filterToggleBtn.addEventListener('click', () => {
                    if (advancedFilters) {
                        advancedFilters.classList.toggle('open');
                    }
                });
            }

            // Market tabs
            document.querySelectorAll('.market-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.target.classList.toggle('active');
                    loadFilings(true);
                });
            });

            // Filter buttons
            document.querySelectorAll('[data-filter]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    loadFilings(true);
                });
            });

            // Stock search
            if (stockSearch) {
                stockSearch.addEventListener('input', handleStockSearch);
            }
            
            // Load more
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', () => {
                    loadFilings(false);
                });
            }
        }

        function getAvailableStocks() {
            let availableStocks = [];
            selectedMarkets.forEach(market => {
                if (STOCK_DATA[market]) {
                    availableStocks = availableStocks.concat(STOCK_DATA[market]);
                }
            });
            return availableStocks;
        }

        function handleStockSearch(e) {
            const query = e.target.value.toLowerCase();
            if (query.length < 1) {
                if (autocompleteDropdown) {
                    autocompleteDropdown.style.display = 'none';
                }
                return;
            }

            const availableStocks = getAvailableStocks();
            const matches = availableStocks.filter(stock => 
                stock.name.toLowerCase().includes(query) || 
                stock.code.toLowerCase().includes(query)
            ).slice(0, 10);

            if (matches.length > 0 && autocompleteDropdown) {
                const html = matches.map(stock => 
                    `<div class="autocomplete-item" onclick="selectStock('${stock.name}', '${stock.code}', '${stock.market}')">
                        <span>${stock.name}</span>
                        <span class="stock-code-small">${stock.code}</span>
                    </div>`
                ).join('');
                
                autocompleteDropdown.innerHTML = html;
                autocompleteDropdown.style.display = 'block';
            } else if (autocompleteDropdown) {
                autocompleteDropdown.style.display = 'none';
            }
        }

        function selectStock(name, code, market) {
            if (!selectedStocks.find(stock => stock.code === code)) {
                selectedStocks.push({ name, code, market });
                renderSelectedStocks();
                loadFilings(true);
            }
            
            if (stockSearch) {
                stockSearch.value = '';
            }
            if (autocompleteDropdown) {
                autocompleteDropdown.style.display = 'none';
            }
        }

        function removeStock(code) {
            selectedStocks = selectedStocks.filter(stock => stock.code !== code);
            renderSelectedStocks();
            loadFilings(true);
        }

        function renderSelectedStocks() {
            if (!selectedStocksEl) return;
            
            const html = selectedStocks.map(stock => 
                `<div class="stock-tag ${stock.market}">
                    <span>${stock.name} (${stock.code})</span>
                    <button class="remove-btn" onclick="removeStock('${stock.code}')">×</button>
                </div>`
            ).join('');
            
            selectedStocksEl.innerHTML = html;
        }

        async function loadFilings(reset = false) {
            if (isLoading) return;
            
            isLoading = true;
            if (reset) {
                currentPage = 1;
                if (timelineEl) timelineEl.innerHTML = '';
            }

            try {
                // Display loading message
                if (loadingEl) {
                    loadingEl.style.display = 'block';
                    loadingEl.textContent = '데이터를 불러오는 중...';
                }

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Generate dummy data for demonstration
                const dummyData = generateDummyTimelineData();
                
                renderFeedItems(dummyData, reset);
                
                if (errorEl) {
                    errorEl.style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to load feed:', error);
                if (errorEl) {
                    errorEl.textContent = '피드 데이터를 불러올 수 없습니다.';
                    errorEl.style.display = 'block';
                }
            } finally {
                isLoading = false;
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
            }
        }

        function generateDummyTimelineData() {
            return [
                {
                    id: 'f1',
                    type: 'filing',
                    title: '삼성전자',
                    subtitle: '3분기 실적공시(잠정)',
                    icon: '📋',
                    time: '10:30',
                    grade: 'A',
                    stock_code: '005930',
                    importance_score: 0.85,
                    url: 'https://dart.fss.or.kr'
                },
                {
                    id: 'n1',
                    type: 'news',
                    title: 'NVIDIA 4분기 실적 전망 상향',
                    subtitle: 'AI 칩 수요 급증으로 매출 증가 예상',
                    icon: '📰',
                    time: '09:15',
                    importance_score: 0.75,
                    url: 'https://news.example.com'
                },
                {
                    id: 'f2',
                    type: 'filing',
                    title: 'SK하이닉스',
                    subtitle: '투자계획 공시',
                    icon: '📋',
                    time: '08:45',
                    grade: 'A',
                    stock_code: '000660',
                    importance_score: 0.65,
                    url: 'https://dart.fss.or.kr'
                }
            ];
        }

        function renderFeedItems(items, reset) {
            if (!timelineEl) return;
            
            const html = items.map(item => {
                if (item.type === 'filing') {
                    let importanceClass = 'importance-low';
                    let importanceLabel = '낮음';
                    let importanceIcon = '⚪';
                    
                    if (item.importance_score >= 0.8) {
                        importanceClass = 'importance-urgent';
                        importanceLabel = '긴급';
                        importanceIcon = '🔴';
                    } else if (item.importance_score >= 0.6) {
                        importanceClass = 'importance-high';
                        importanceLabel = '높음';
                        importanceIcon = '🟠';
                    } else if (item.importance_score >= 0.3) {
                        importanceClass = 'importance-normal';
                        importanceLabel = '보통';
                        importanceIcon = '🟡';
                    }

                    return `
                        <div class="filing-card">
                            <div class="card-actions">
                                <button class="card-action-btn" onclick="toggleBookmark('${item.id}', '${item.title}', 'filing')">🔖</button>
                                <button class="card-action-btn" onclick="toggleLike('${item.id}')">❤️ ${Math.floor(Math.random() * 50)}</button>
                            </div>
                            <div class="filing-header">
                                <div class="filing-time">${item.time}</div>
                                <div class="filing-icon">${item.icon}</div>
                                <div class="filing-content">
                                    <div class="filing-title">
                                        <span class="company-name">${item.title}</span>
                                        <span class="grade-badge grade-${item.grade?.toLowerCase() || 'a'}">${item.grade || 'A'}등급</span>
                                        ${item.stock_code ? `<span class="stock-code">${item.stock_code}</span>` : ''}
                                        <span class="importance-badge ${importanceClass}">
                                            ${importanceIcon} ${importanceLabel}
                                        </span>
                                    </div>
                                    <div class="report-name">${item.subtitle}</div>
                                </div>
                                ${item.url ? `
                                    <a href="${item.url}" target="_blank" class="dart-link">
                                        🔗 DART
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="news-card">
                            <div class="card-actions">
                                <button class="card-action-btn" onclick="toggleBookmark('${item.id}', '${item.title}', 'news')">🔖</button>
                                <button class="card-action-btn" onclick="toggleLike('${item.id}')">❤️ ${Math.floor(Math.random() * 50)}</button>
                            </div>
                            <div class="filing-header">
                                <div class="filing-time">${item.time}</div>
                                <div class="filing-icon">${item.icon}</div>
                                <div class="filing-content">
                                    <div class="filing-title">
                                        <span class="company-name">${item.title}</span>
                                    </div>
                                    <div class="report-name">${item.subtitle}</div>
                                </div>
                                ${item.url ? `
                                    <a href="${item.url}" target="_blank" class="news-link">
                                        🔗 뉴스
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }).join('');

            if (reset) {
                timelineEl.innerHTML = html;
            } else {
                timelineEl.insertAdjacentHTML('beforeend', html);
            }
        }

        function toggleBookmark(itemId, title, type) {
            const notes = loadFromStorage('notes');
            const newNote = {
                id: 'n' + Date.now(),
                type: type === 'filing' ? 'filing' : 'news',
                title: title,
                url: type === 'filing' ? 'https://dart.fss.or.kr' : 'https://news.example.com',
                content: '타임라인에서 북마크함',
                folder: type === 'filing' ? '공시' : '뉴스',
                tags: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            notes.unshift(newNote);
            saveToStorage('notes', notes);
            
            const badge = document.getElementById('notesBadge');
            if (badge) {
                badge.textContent = notes.length;
                badge.style.display = 'flex';
            }
            
            alert('노트에 저장되었습니다!');
        }

        function toggleLike(itemId) {
            if (event && event.target) {
                event.target.classList.toggle('active');
            }
        }

        function refreshData() {
            loadFilings(true);
        }

        // Modal functions
        function editProfile() {
            document.getElementById('editProfileModal').classList.add('active');
        }

        function addToPortfolio() {
            document.getElementById('addPortfolioModal').classList.add('active');
        }

        function openNotifications() {
            const notifications = loadFromStorage('notifications');
            const container = document.getElementById('allNotifications');
            
            const html = notifications.map(notif => {
                let iconClass = 'notification-icon ';
                let icon = '';
                
                switch (notif.type) {
                    case 'like': iconClass += 'like'; icon = '❤️'; break;
                    case 'comment': iconClass += 'comment'; icon = '💬'; break;
                    case 'follow': iconClass += 'follow'; icon = '👤'; break;
                }
                
                return `
                    <div class="notification-item">
                        <div class="${iconClass}">${icon}</div>
                        <div class="notification-content">
                            <div class="notification-text">${notif.text}</div>
                            <div class="notification-time">${notif.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            document.getElementById('notificationsModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function saveProfile() {
            const name = document.getElementById('editName').value;
            const bio = document.getElementById('editBio').value;
            
            document.getElementById('myName').textContent = name;
            document.getElementById('myBio').textContent = bio;
            document.getElementById('myAvatar').textContent = name.charAt(0);
            
            closeModal('editProfileModal');
        }

        function saveToPortfolio() {
            const select = document.getElementById('addStockSelect');
            const quantity = parseFloat(document.getElementById('addQuantity').value);
            const avgPrice = parseFloat(document.getElementById('addAvgPrice').value);
            
            if (!select.value || !quantity || !avgPrice) {
                alert('모든 필드를 입력해주세요');
                return;
            }
            
            const [ticker, name, market] = select.value.split(':');
            
            const portfolio = loadFromStorage('portfolio');
            const newHolding = { ticker, name, market, quantity, avgPrice };
            
            const existingIndex = portfolio.findIndex(item => item.ticker === ticker);
            if (existingIndex !== -1) {
                portfolio[existingIndex] = newHolding;
            } else {
                portfolio.push(newHolding);
            }
            
            saveToStorage('portfolio', portfolio);
            loadPortfolioManagement();
            
            if (currentTab === 'dashboard') {
                loadPortfolioSummary();
            }
            
            select.value = '';
            document.getElementById('addQuantity').value = '';
            document.getElementById('addAvgPrice').value = '';
            
            closeModal('addPortfolioModal');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeDummyData();
            loadDashboardData();
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            console.log('투자 SNS 플랫폼이 초기화되었습니다!');
        });
    </script>
</body>
</html>