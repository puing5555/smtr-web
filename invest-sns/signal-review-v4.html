<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ íŠœë²„ ì‹œê·¸ë„ ê²€ì¦ ë¦¬ë·° v4</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f0f4f8; color: #1a1a2e; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 16px; margin-bottom: 24px; }
        .header h1 { font-size: 24px; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .stats { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .stat-card { background: white; border-radius: 12px; padding: 16px 20px; flex: 1; min-width: 120px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .stat-number { font-size: 28px; font-weight: 700; color: #667eea; }
        .stat-label { font-size: 12px; color: #666; margin-top: 4px; }
        .filters { background: white; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .filter-row { display: flex; gap: 12px; flex-wrap: wrap; align-items: end; }
        .filter-group { display: flex; flex-direction: column; gap: 4px; }
        .filter-label { font-size: 12px; font-weight: 600; color: #666; }
        .filter-select, .filter-input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .signals-grid { display: flex; flex-direction: column; gap: 16px; }
        .signal-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #ccc; position: relative; }
        .signal-card[data-signal="STRONG_BUY"] { border-left-color: #dc2626; }
        .signal-card[data-signal="BUY"] { border-left-color: #ef4444; }
        .signal-card[data-signal="POSITIVE"] { border-left-color: #f97316; }
        .signal-card[data-signal="HOLD"] { border-left-color: #eab308; }
        .signal-card[data-signal="NEUTRAL"] { border-left-color: #6b7280; }
        .signal-card[data-signal="CONCERN"] { border-left-color: #8b5cf6; }
        .signal-card[data-signal="SELL"] { border-left-color: #3b82f6; }
        .signal-card[data-signal="STRONG_SELL"] { border-left-color: #1d4ed8; }
        .signal-card.hide { display: none; }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .signal-asset { font-size: 18px; font-weight: 700; }
        .signal-type { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; color: white; }
        .signal-type.STRONG_BUY { background: #dc2626; }
        .signal-type.BUY { background: #ef4444; }
        .signal-type.POSITIVE { background: #f97316; }
        .signal-type.HOLD { background: #eab308; }
        .signal-type.NEUTRAL { background: #6b7280; }
        .signal-type.CONCERN { background: #8b5cf6; }
        .signal-type.SELL { background: #3b82f6; }
        .signal-type.STRONG_SELL { background: #1d4ed8; }
        .quote { background: #f8f9fa; padding: 12px 16px; border-radius: 8px; margin: 12px 0; font-style: italic; color: #333; border-left: 3px solid #667eea; }
        .meta { display: flex; gap: 16px; font-size: 13px; color: #666; margin-top: 8px; flex-wrap: wrap; align-items: center; }
        .meta a { color: #ef4444; text-decoration: none; }
        .meta a:hover { text-decoration: underline; }
        .video-date { background: #e5e7eb; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .signal-actions { display: flex; gap: 8px; margin-top: 12px; align-items: center; flex-wrap: wrap; }
        .btn { padding: 8px 16px; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 14px; }
        .btn:hover { background: #f8f9fa; }
        .btn.primary { background: #667eea; color: white; border-color: #667eea; }
        .btn.primary:hover { background: #5a6fd8; }
        .btn.danger { background: #ef4444; color: white; border-color: #ef4444; }
        .btn.danger:hover { background: #dc2626; }
        .btn.success { background: #10b981; color: white; border-color: #10b981; }
        .btn.success:hover { background: #059669; }

        /* Opus diff styles */
        .opus-section { margin-top: 16px; padding: 16px; background: #f0f9ff; border-radius: 8px; border: 1px solid #e0f2fe; }
        .opus-header { font-weight: 600; color: #0369a1; margin-bottom: 12px; }
        .diff-container { display: flex; gap: 16px; flex-wrap: wrap; }
        .diff-side { flex: 1; min-width: 300px; }
        .diff-header { font-size: 12px; font-weight: 600; color: #666; margin-bottom: 8px; padding: 4px 8px; border-radius: 4px; }
        .diff-original { background: #fef2f2; border: 1px solid #fecaca; }
        .diff-suggested { background: #f0fdf4; border: 1px solid #bbf7d0; }
        .diff-content { padding: 12px; background: white; border-radius: 4px; font-size: 13px; line-height: 1.5; }

        /* Review controls */
        .review-controls { margin-top: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; }
        .review-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 8px; }
        .checkbox-container { display: flex; align-items: center; gap: 4px; }
        .reject-options { margin-left: 20px; display: none; flex-wrap: wrap; gap: 8px; align-items: center; }
        .reject-options.show { display: flex; }
        .signal-type-select { padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }

        /* Action buttons */
        .action-buttons { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
        
        .spinner { display: none; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Status indicators */
        .status-indicator { font-size: 11px; padding: 2px 6px; border-radius: 3px; font-weight: 600; }
        .status-pending { background: #fef3c7; color: #d97706; }
        .status-approved { background: #dcfce7; color: #16a34a; }
        .status-rejected { background: #fee2e2; color: #dc2626; }
        .status-opus-modified { background: #e0e7ff; color: #4338ca; }
        
        /* Alert box */
        .alert { margin-bottom: 16px; padding: 12px 16px; border-radius: 8px; font-size: 14px; }
        .alert.info { background: #e0f2fe; border: 1px solid #0891b2; color: #0891b2; }
        .alert.success { background: #dcfce7; border: 1px solid #16a34a; color: #16a34a; }
        .alert.warning { background: #fef3c7; border: 1px solid #d97706; color: #d97706; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ìœ íŠœë²„ ì‹œê·¸ë„ ê²€ì¦ ë¦¬ë·° v4</h1>
            <p>Claude Sonnetì´ ì¶”ì¶œí•œ ì‹œê·¸ë„ì„ ê²€í† í•˜ê³  Opus ê²€ì¦ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì—¬ ìµœì¢… ìŠ¹ì¸</p>
        </div>

        <div class="alert info">
            <strong>ğŸ”„ ì‚¬ì´íŠ¸ ë™ê¸°í™”:</strong> ë¦¬ë·° ì™„ë£Œ í›„ "ë³¸ì‚¬ì´íŠ¸ ë™ê¸°í™”" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ SMTR ì›¹ì‚¬ì´íŠ¸ì— ë°˜ì˜í•˜ì„¸ìš”.
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ì´ ì‹œê·¸ë„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="opusModifiedCount">0</div>
                <div class="stat-label">Opus ìˆ˜ì • ì œì•ˆ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedCount">0</div>
                <div class="stat-label">ìŠ¹ì¸ë¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rejectedCount">0</div>
                <div class="stat-label">ê±°ë¶€ë¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">ê²€í† ëŒ€ê¸°</div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">ì¢…ëª©ëª…</label>
                    <select id="stockFilter" class="filter-select">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ì‹œê·¸ë„ íƒ€ì…</label>
                    <select id="signalTypeFilter" class="filter-select">
                        <option value="">ì „ì²´</option>
                        <option value="STRONG_BUY">STRONG_BUY</option>
                        <option value="BUY">BUY</option>
                        <option value="POSITIVE">POSITIVE</option>
                        <option value="HOLD">HOLD</option>
                        <option value="NEUTRAL">NEUTRAL</option>
                        <option value="CONCERN">CONCERN</option>
                        <option value="SELL">SELL</option>
                        <option value="STRONG_SELL">STRONG_SELL</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ë¦¬ë·° ìƒíƒœ</label>
                    <select id="reviewStatusFilter" class="filter-select">
                        <option value="">ì „ì²´</option>
                        <option value="pending">ê²€í† ëŒ€ê¸°</option>
                        <option value="approved">ìŠ¹ì¸ë¨</option>
                        <option value="rejected">ê±°ë¶€ë¨</option>
                        <option value="opus-modified">Opus ìˆ˜ì •</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ìœ íŠœë²„</label>
                    <select id="influencerFilter" class="filter-select">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ê²€ìƒ‰</label>
                    <input type="text" id="searchInput" class="filter-input" placeholder="ì¢…ëª©ëª…, ë‚´ìš© ê²€ìƒ‰...">
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button id="syncSiteBtn" class="btn success">ğŸ”„ ë³¸ì‚¬ì´íŠ¸ ë™ê¸°í™”</button>
            <button id="exportTsBtn" class="btn primary">TypeScript íŒŒì¼ ë‚´ë³´ë‚´ê¸°</button>
        </div>

        <div class="signals-grid" id="signalsContainer">
            <!-- Signals will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // ë°ì´í„° placeholder - embed_v4.jsì—ì„œ êµì²´ë¨
        let signalsData = {{SIGNALS_DATA}};
        let reviewsData = {{REVIEWS_DATA}};
        let opusData = {{OPUS_DATA}};

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤
        const STORAGE_KEY = 'signal-review-v4';

        // ì „ì—­ ìƒíƒœ
        let currentReviews = {};
        let filteredSignals = [];

        // ì´ˆê¸°í™”
        function init() {
            console.log('ğŸš€ ë¦¬ë·° í˜ì´ì§€ v4 ì´ˆê¸°í™” ì‹œì‘');
            console.log('ì‹œê·¸ë„ ë°ì´í„°:', signalsData?.length || 0);
            console.log('ë¦¬ë·° ë°ì´í„°:', Object.keys(reviewsData || {}).length);
            console.log('Opus ë°ì´í„°:', Object.keys(opusData || {}).length);
            
            loadReviewsFromStorage();
            mergeExistingReviews();
            populateFilters();
            renderSignals();
            updateStats();
            bindEvents();
            
            console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
        }

        function loadReviewsFromStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    currentReviews = JSON.parse(saved);
                    console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¦¬ë·° ë¡œë“œ:', Object.keys(currentReviews).length);
                } catch (e) {
                    console.error('Failed to parse saved reviews:', e);
                    currentReviews = {};
                }
            }
        }

        function mergeExistingReviews() {
            // _matched_reviews.jsonì—ì„œ ê¸°ì¡´ ë¦¬ë·° ìƒíƒœ ë¡œë“œ
            Object.keys(reviewsData || {}).forEach(key => {
                if (!currentReviews[key]) {
                    currentReviews[key] = {
                        status: reviewsData[key].status,
                        time: reviewsData[key].time,
                        signalType: null,
                        action: null
                    };
                }
            });
        }

        function saveReviewsToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(currentReviews));
        }

        function populateFilters() {
            const stocks = [...new Set(signalsData.map(s => s.stockName))].sort();
            const influencers = [...new Set(signalsData.map(s => s.influencer))].sort();

            const stockFilter = document.getElementById('stockFilter');
            stocks.forEach(stock => {
                const option = document.createElement('option');
                option.value = stock;
                option.textContent = stock;
                stockFilter.appendChild(option);
            });

            const influencerFilter = document.getElementById('influencerFilter');
            influencers.forEach(influencer => {
                const option = document.createElement('option');
                option.value = influencer;
                option.textContent = influencer;
                influencerFilter.appendChild(option);
            });
        }

        function getSignalKey(signal) {
            return `${signal.youtubeLink.split('/').pop()}_${signal.stockName}`;
        }

        function getReviewStatus(signal) {
            const key = getSignalKey(signal);
            return currentReviews[key] || { status: 'pending', time: null, signalType: null, action: null };
        }

        function getOpusResult(signal) {
            const key = getSignalKey(signal);
            return opusData[key] || null;
        }

        function renderSignals() {
            filteredSignals = filterSignals();
            const container = document.getElementById('signalsContainer');
            
            if (filteredSignals.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ì¡°ê±´ì— ë§ëŠ” ì‹œê·¸ë„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = filteredSignals.map(signal => {
                const review = getReviewStatus(signal);
                const opusResult = getOpusResult(signal);
                const key = getSignalKey(signal);

                return `
                    <div class="signal-card" data-signal="${signal.signalType}" data-key="${key}">
                        <div class="signal-header">
                            <span class="signal-asset">${signal.stockName} (${signal.stock})</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="signal-type ${signal.signalType}">${signal.signalType}</span>
                                <span class="status-indicator status-${review.status}">${getStatusText(review.status)}</span>
                                <span class="video-date">${signal.videoDate}</span>
                            </div>
                        </div>
                        
                        <div class="quote">${signal.content}</div>
                        
                        <div class="meta">
                            <span>ìœ íŠœë²„: ${signal.influencer}</span>
                            <span>ì‹ ë¢°ë„: ${signal.confidence}</span>
                            <span>íƒ€ì„í”„ë ˆì„: ${signal.timeframe}</span>
                            <a href="${signal.youtubeLink}&t=${Math.floor(parseFloat(signal.timestamp) || 0)}s" target="_blank">ì˜ìƒ ë³´ê¸° (${signal.timestamp})</a>
                        </div>

                        ${(review.status === 'rejected' && opusResult) ? renderOpusSection(signal, opusResult) : ''}

                        <div class="review-controls">
                            ${renderReviewControls(signal, review)}
                        </div>
                    </div>
                `;
            }).join('');

            bindSignalEvents();
        }

        function renderOpusSection(signal, opusResult) {
            if (opusResult.verdict === 'approve') {
                return `
                    <div class="opus-section">
                        <div class="opus-header">âœ… Opus ê²€í†  ê²°ê³¼: ìŠ¹ì¸</div>
                        <div style="font-size: 13px; color: #059669;">${opusResult.reasoning || 'Opusê°€ ì´ ì‹œê·¸ë„ì„ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤.'}</div>
                    </div>
                `;
            } else if (opusResult.verdict === 'modify') {
                return `
                    <div class="opus-section">
                        <div class="opus-header">ğŸ”„ Opus ìˆ˜ì • ì œì•ˆ</div>
                        <div style="font-size: 13px; color: #0369a1; margin-bottom: 12px;">${opusResult.reasoning || 'Opusê°€ ìˆ˜ì •ì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.'}</div>
                        <div class="diff-container">
                            <div class="diff-side">
                                <div class="diff-header diff-original">ì›ë³¸ ì‹œê·¸ë„</div>
                                <div class="diff-content">
                                    <div><strong>íƒ€ì…:</strong> ${signal.signalType}</div>
                                    <div><strong>ë‚´ìš©:</strong> ${signal.content}</div>
                                </div>
                            </div>
                            <div class="diff-side">
                                <div class="diff-header diff-suggested">Opus ì œì•ˆ</div>
                                <div class="diff-content">
                                    <div><strong>íƒ€ì…:</strong> ${opusResult.suggested?.signalType || signal.signalType}</div>
                                    <div><strong>ë‚´ìš©:</strong> ${opusResult.suggested?.content || signal.content}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            return '';
        }

        function renderReviewControls(signal, review) {
            const key = getSignalKey(signal);
            
            // Opus ê²€í†  ë²„íŠ¼ì€ ê±°ë¶€ëœ ì‹œê·¸ë„ì—ë§Œ í‘œì‹œ
            const opusButton = review.status === 'rejected' ? 
                `<button class="btn primary" onclick="requestOpusReview('${key}')" style="margin-left: 12px;">
                    ğŸ¤– Opus ê²€í† 
                </button>` : '';
            
            return `
                <div class="review-row">
                    <div class="checkbox-container">
                        <input type="checkbox" id="approve-${key}" ${review.status === 'approved' ? 'checked' : ''} 
                               onchange="updateReviewStatus('${key}', 'approved', this.checked)">
                        <label for="approve-${key}">ìŠ¹ì¸</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="reject-${key}" ${review.status === 'rejected' ? 'checked' : ''} 
                               onchange="toggleReject('${key}', this.checked)">
                        <label for="reject-${key}">ê±°ë¶€</label>
                    </div>
                    <div id="reject-options-${key}" class="reject-options ${review.status === 'rejected' ? 'show' : ''}">
                        <label>
                            <input type="radio" name="reject-action-${key}" value="delete" 
                                   ${review.action === 'delete' ? 'checked' : ''} 
                                   onchange="updateRejectAction('${key}', 'delete')"> ì‚­ì œ
                        </label>
                        <label>
                            <input type="radio" name="reject-action-${key}" value="modify" 
                                   ${review.action === 'modify' ? 'checked' : ''} 
                                   onchange="updateRejectAction('${key}', 'modify')"> ìˆ˜ì •
                        </label>
                        <select class="signal-type-select" id="modify-type-${key}" 
                                ${review.action !== 'modify' ? 'style="display:none"' : ''} 
                                onchange="updateModifiedSignalType('${key}', this.value)">
                            <option value="STRONG_BUY" ${review.signalType === 'STRONG_BUY' ? 'selected' : ''}>STRONG_BUY</option>
                            <option value="BUY" ${review.signalType === 'BUY' ? 'selected' : ''}>BUY</option>
                            <option value="POSITIVE" ${review.signalType === 'POSITIVE' ? 'selected' : ''}>POSITIVE</option>
                            <option value="HOLD" ${review.signalType === 'HOLD' ? 'selected' : ''}>HOLD</option>
                            <option value="NEUTRAL" ${review.signalType === 'NEUTRAL' ? 'selected' : ''}>NEUTRAL</option>
                            <option value="CONCERN" ${review.signalType === 'CONCERN' ? 'selected' : ''}>CONCERN</option>
                            <option value="SELL" ${review.signalType === 'SELL' ? 'selected' : ''}>SELL</option>
                            <option value="STRONG_SELL" ${review.signalType === 'STRONG_SELL' ? 'selected' : ''}>STRONG_SELL</option>
                        </select>
                        ${opusButton}
                    </div>
                </div>
            `;
        }

        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'ê²€í† ëŒ€ê¸°';
                case 'approved': return 'ìŠ¹ì¸ë¨';
                case 'rejected': return 'ê±°ë¶€ë¨';
                case 'opus-modified': return 'Opus ìˆ˜ì •';
                default: return 'ê²€í† ëŒ€ê¸°';
            }
        }

        function updateReviewStatus(key, status, checked) {
            if (!currentReviews[key]) {
                currentReviews[key] = { status: 'pending', time: null, signalType: null, action: null };
            }

            if (checked) {
                currentReviews[key].status = status;
                currentReviews[key].time = new Date().toLocaleString('ko-KR');
                
                // ìŠ¹ì¸ ì‹œ ê±°ë¶€ ì²´í¬ë°•ìŠ¤ í•´ì œ
                const rejectCheckbox = document.getElementById(`reject-${key}`);
                if (rejectCheckbox) {
                    rejectCheckbox.checked = false;
                }
                
                // ê±°ë¶€ ì˜µì…˜ ìˆ¨ê¹€
                const rejectOptions = document.getElementById(`reject-options-${key}`);
                if (rejectOptions) {
                    rejectOptions.classList.remove('show');
                }
            } else {
                currentReviews[key].status = 'pending';
                currentReviews[key].time = null;
            }

            saveReviewsToStorage();
            updateStats();
            updateStatusIndicator(key);
        }

        function toggleReject(key, checked) {
            if (!currentReviews[key]) {
                currentReviews[key] = { status: 'pending', time: null, signalType: null, action: null };
            }

            if (checked) {
                currentReviews[key].status = 'rejected';
                currentReviews[key].time = new Date().toLocaleString('ko-KR');
                
                // ìŠ¹ì¸ ì²´í¬ë°•ìŠ¤ í•´ì œ
                const approveCheckbox = document.getElementById(`approve-${key}`);
                if (approveCheckbox) {
                    approveCheckbox.checked = false;
                }

                // ê±°ë¶€ ì˜µì…˜ í‘œì‹œ
                const rejectOptions = document.getElementById(`reject-options-${key}`);
                if (rejectOptions) {
                    rejectOptions.classList.add('show');
                }
            } else {
                currentReviews[key].status = 'pending';
                currentReviews[key].time = null;
                
                // ê±°ë¶€ ì˜µì…˜ ìˆ¨ê¹€
                const rejectOptions = document.getElementById(`reject-options-${key}`);
                if (rejectOptions) {
                    rejectOptions.classList.remove('show');
                }
            }

            saveReviewsToStorage();
            updateStats();
            updateStatusIndicator(key);
        }

        function updateRejectAction(key, action) {
            if (!currentReviews[key]) {
                currentReviews[key] = { status: 'rejected', time: new Date().toLocaleString('ko-KR'), signalType: null, action: null };
            }

            currentReviews[key].action = action;
            
            // ìˆ˜ì • íƒ€ì… ì„ íƒ í‘œì‹œ/ìˆ¨ê¹€
            const modifySelect = document.getElementById(`modify-type-${key}`);
            if (modifySelect) {
                modifySelect.style.display = action === 'modify' ? 'inline-block' : 'none';
            }

            saveReviewsToStorage();
        }

        function updateModifiedSignalType(key, signalType) {
            if (!currentReviews[key]) {
                currentReviews[key] = { status: 'rejected', time: new Date().toLocaleString('ko-KR'), signalType: null, action: 'modify' };
            }

            currentReviews[key].signalType = signalType;
            saveReviewsToStorage();
        }

        function updateStatusIndicator(key) {
            const card = document.querySelector(`[data-key="${key}"]`);
            if (card) {
                const indicator = card.querySelector('.status-indicator');
                const review = currentReviews[key];
                if (indicator && review) {
                    indicator.className = `status-indicator status-${review.status}`;
                    indicator.textContent = getStatusText(review.status);
                }
            }
        }

        function filterSignals() {
            const stockFilter = document.getElementById('stockFilter').value;
            const signalTypeFilter = document.getElementById('signalTypeFilter').value;
            const reviewStatusFilter = document.getElementById('reviewStatusFilter').value;
            const influencerFilter = document.getElementById('influencerFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();

            return signalsData.filter(signal => {
                const review = getReviewStatus(signal);
                
                return (!stockFilter || signal.stockName === stockFilter) &&
                       (!signalTypeFilter || signal.signalType === signalTypeFilter) &&
                       (!reviewStatusFilter || review.status === reviewStatusFilter) &&
                       (!influencerFilter || signal.influencer === influencerFilter) &&
                       (!searchInput || 
                        signal.stockName.toLowerCase().includes(searchInput) ||
                        signal.content.toLowerCase().includes(searchInput) ||
                        signal.stock.toLowerCase().includes(searchInput));
            }).sort((a, b) => new Date(b.videoDate) - new Date(a.videoDate)); // ìµœì‹ ìˆœ ì •ë ¬
        }

        function updateStats() {
            const total = signalsData.length;
            let approved = 0, rejected = 0, pending = 0, opusModified = 0;

            signalsData.forEach(signal => {
                const review = getReviewStatus(signal);
                const opusResult = getOpusResult(signal);
                
                switch (review.status) {
                    case 'approved': approved++; break;
                    case 'rejected': rejected++; break;
                    default: pending++; break;
                }

                if (opusResult && opusResult.verdict === 'modify') {
                    opusModified++;
                }
            });

            document.getElementById('totalCount').textContent = total;
            document.getElementById('approvedCount').textContent = approved;
            document.getElementById('rejectedCount').textContent = rejected;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('opusModifiedCount').textContent = opusModified;
        }

        function bindEvents() {
            // í•„í„° ì´ë²¤íŠ¸
            ['stockFilter', 'signalTypeFilter', 'reviewStatusFilter', 'influencerFilter', 'searchInput'].forEach(id => {
                document.getElementById(id).addEventListener('change', () => {
                    renderSignals();
                });
                document.getElementById(id).addEventListener('input', () => {
                    renderSignals();
                });
            });

            // ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('syncSiteBtn').addEventListener('click', syncToSite);
            document.getElementById('exportTsBtn').addEventListener('click', exportTypeScriptFile);
        }

        function bindSignalEvents() {
            // ì´ë¯¸ renderSignalsì—ì„œ ì¸ë¼ì¸ìœ¼ë¡œ ë°”ì¸ë”©ë¨
        }

        function requestOpusReview(key) {
            // í•´ë‹¹ ì‹œê·¸ë„ì— ëŒ€í•œ Opus ê²€í†  ìš”ì²­
            const signal = signalsData.find(s => getSignalKey(s) === key);
            if (!signal) {
                alert('ì‹œê·¸ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ API í˜¸ì¶œ
            console.log(`Opus ê²€í†  ìš”ì²­: ${signal.stockName} - ${signal.content}`);
            
            // UI í”¼ë“œë°±
            const button = event.target;
            button.disabled = true;
            button.innerHTML = 'ğŸ”„ ê²€í† ì¤‘...';
            
            // ì„ì‹œë¡œ 3ì´ˆ í›„ ì™„ë£Œ ì²˜ë¦¬ (ì‹¤ì œë¡œëŠ” API ì‘ë‹µ)
            setTimeout(() => {
                button.disabled = false;
                button.innerHTML = 'ğŸ¤– Opus ê²€í† ';
                alert('Opus ê²€í† ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ëŠ” ë³„ë„ ì‹œìŠ¤í…œì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }, 3000);
        }

        function syncToSite() {
            // í˜„ì¬ ë¦¬ë·° ìƒíƒœë¥¼ JSONìœ¼ë¡œ ì €ì¥
            const reviewStateData = {
                reviews: currentReviews,
                timestamp: new Date().toISOString(),
                totalSignals: signalsData.length
            };

            const blob = new Blob([JSON.stringify(reviewStateData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `review-state-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('ë¦¬ë·° ìƒíƒœë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.\\n\\në‹¤ìŒ ë‹¨ê³„:\\n1. í„°ë¯¸ë„ì—ì„œ "node sync_to_site.js" ì‹¤í–‰\\n2. npm run buildë¡œ ë³¸ì‚¬ì´íŠ¸ ë¹Œë“œ');
        }

        function exportTypeScriptFile() {
            const approvedSignals = signalsData.filter(signal => {
                const review = getReviewStatus(signal);
                return review.status === 'approved' || 
                       (review.status === 'rejected' && review.action === 'modify');
            }).map(signal => {
                const review = getReviewStatus(signal);
                if (review.status === 'rejected' && review.action === 'modify' && review.signalType) {
                    return { ...signal, signalType: review.signalType };
                }
                return signal;
            });

            // TypeScript í˜•íƒœë¡œ ì¶œë ¥
            const tsContent = `// ì½”ë¦°ì´ ì•„ë¹  ì‹¤ì œ ì‹œê·¸ë„ ë°ì´í„° (${approvedSignals.length}ê°œ)
// ìë™ ìƒì„±ë¨ - ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”

export interface CorinpapaSignal {
  id: number;
  influencer: string;
  stock: string;
  stockName: string;
  signalType: 'STRONG_BUY' | 'BUY' | 'POSITIVE' | 'HOLD' | 'NEUTRAL' | 'CONCERN' | 'SELL' | 'STRONG_SELL';
  content: string;
  timestamp: string;
  youtubeLink: string;
  analysis: {
    summary: string;
    detail: string;
  };
  videoDate: string;
  videoTitle: string;
  confidence: string;
  timeframe: string;
  conditional: boolean;
  skinInGame: boolean;
  hedged: boolean;
  videoSummary?: string;
}

// ì‹¤ì œ ì‹œê·¸ë„ ë°ì´í„° (${approvedSignals.length}ê°œ, ìµœì‹ ìˆœ ì •ë ¬)
export const corinpapaSignals: CorinpapaSignal[] = ${JSON.stringify(approvedSignals, null, 2)};`;
            
            const blob = new Blob([tsContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `corinpapa-signals-${new Date().toISOString().split('T')[0]}.ts`;
            a.click();
            URL.revokeObjectURL(url);

            console.log('ìŠ¹ì¸ëœ ì‹œê·¸ë„ ìˆ˜:', approvedSignals.length);
            alert(`ìŠ¹ì¸ëœ ì‹œê·¸ë„ ${approvedSignals.length}ê°œë¥¼ TypeScript íŒŒì¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.\\n\\në‹¤ìŒ ë‹¨ê³„:\\n1. ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì„ src/data/corinpapa-signals.tsë¡œ êµì²´\\n2. npm run buildë¡œ ì‚¬ì´íŠ¸ ë¹Œë“œ`);
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>