<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì• ë„ë¦¬ìŠ¤íŠ¸ ì°¨íŠ¸ - ì‚¼ì„±ì „ì</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0e17;--bg2:#111827;--bg3:#1a2332;--bg4:#243044;
--accent:#3b82f6;--accent2:#60a5fa;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--purple:#a855f7;
--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
--border:#1e293b;--border2:#334155;
}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

.nav{position:sticky;top:0;z-index:100;background:rgba(10,14,23,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 20px}
.nav-inner{max-width:1400px;margin:0 auto;display:flex;align-items:center;height:60px;gap:8px}
.logo{font-weight:900;font-size:20px;background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-right:auto;cursor:pointer;letter-spacing:-.5px}

.container{max-width:1400px;margin:0 auto;padding:20px}

/* 1. ì¢…ëª© ê²€ìƒ‰ ë°” */
.search-wrap{position:relative;margin-bottom:20px}
.search-wrap input{width:100%;padding:14px 20px 14px 48px;background:var(--bg2);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;font-family:inherit;outline:none;transition:.2s}
.search-wrap input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(59,130,246,.15)}
.search-wrap::before{content:'ğŸ”';position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:18px}
.search-dropdown{position:absolute;top:100%;left:0;right:0;background:var(--bg2);border:1px solid var(--border2);border-radius:12px;margin-top:4px;overflow:hidden;display:none;z-index:50;max-height:300px;overflow-y:auto}
.search-dropdown.show{display:block}
.search-item{padding:12px 20px;cursor:pointer;display:flex;justify-content:space-between;transition:.15s}
.search-item:hover{background:var(--bg3)}
.search-item .ticker{color:var(--accent2);font-weight:700;font-size:14px}

/* 2. ì°¨íŠ¸ ì„¹ì…˜ */
.chart-section{position:relative;background:var(--bg2);border-radius:16px;border:1px solid var(--border);overflow:hidden;margin-bottom:20px}
.chart-header{padding:16px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px}
.chart-header h2{font-size:18px;font-weight:700}
.chart-header .price{font-size:24px;font-weight:900;color:var(--text)}
.chart-header .change{font-size:14px;margin-left:8px;font-weight:600}
.chart-header .change.up{color:var(--green)}
.chart-header .change.down{color:var(--red)}
#stockChart{width:100%;height:420px}

/* ë§ˆì»¤ ê´€ë ¨ */
.marker-dot{position:absolute;pointer-events:auto;cursor:pointer;width:14px;height:14px;border-radius:50%;border:2px solid rgba(255,255,255,.4);box-shadow:0 2px 8px rgba(0,0,0,.5);transition:transform .15s,box-shadow .15s;z-index:51;display:flex;align-items:center;justify-content:center;font-size:10px;color:white;font-weight:bold}
.marker-dot:hover{transform:scale(1.4);box-shadow:0 0 16px rgba(255,255,255,.4);z-index:55}
.marker-dot.buy{background:#10b981}
.marker-dot.sell{background:#ef4444}
.marker-dot.neutral{background:#f59e0b}
.marker-count{position:absolute;top:-6px;right:-6px;background:var(--accent);color:#fff;font-size:8px;font-weight:800;min-width:12px;height:12px;border-radius:6px;display:flex;align-items:center;justify-content:center;padding:0 2px;line-height:1}

/* 3. íˆ´íŒ */
.marker-tooltip{position:absolute;z-index:60;background:linear-gradient(135deg,var(--bg3) 0%,#1e2a3d 100%);border:1px solid var(--border2);border-radius:16px;padding:0;min-width:320px;max-width:420px;box-shadow:0 24px 48px rgba(0,0,0,.6);pointer-events:auto;opacity:0;transform:translateY(8px) scale(.97);transition:opacity .25s,transform .25s;visibility:hidden}
.marker-tooltip.show{opacity:1;transform:translateY(0) scale(1);visibility:visible}
.marker-tooltip .tt-header{padding:16px 18px 12px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,.05)}
.marker-tooltip .tt-analyst{font-weight:700;font-size:15px}
.marker-tooltip .tt-firm{font-size:12px;color:var(--text3)}
.marker-tooltip .tt-badge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:800;margin-left:auto}
.marker-tooltip .tt-badge.buy{background:rgba(16,185,129,.2);color:#10b981}
.marker-tooltip .tt-badge.sell{background:rgba(239,68,68,.2);color:#ef4444}
.marker-tooltip .tt-badge.neutral{background:rgba(245,158,11,.2);color:#f59e0b}
.marker-tooltip .tt-body{padding:14px 18px}
.marker-tooltip .tt-target{font-size:18px;font-weight:700;color:var(--accent2);margin-bottom:8px}
.marker-tooltip .tt-summary{color:var(--text);font-size:13px;line-height:1.5;margin-bottom:12px}
.marker-tooltip .close-btn{position:absolute;top:10px;right:12px;background:rgba(255,255,255,.06);border:none;color:var(--text3);cursor:pointer;font-size:14px;width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:.15s}
.marker-tooltip .close-btn:hover{background:rgba(255,255,255,.12);color:var(--text)}

/* 4. ë¦¬í¬íŠ¸ ìƒì„¸ íŒì—… */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:28px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}
.modal h3{font-size:20px;font-weight:900;margin-bottom:16px;display:flex;align-items:center;gap:12px}
.modal .report-meta{background:var(--bg3);padding:16px;border-radius:12px;margin-bottom:20px}
.modal .report-meta .meta-row{display:flex;justify-content:space-between;margin-bottom:8px}
.modal .report-meta .meta-label{color:var(--text3);font-size:13px}
.modal .report-meta .meta-value{color:var(--text);font-weight:600}
.modal .report-content{line-height:1.6;color:var(--text);margin-bottom:20px}
.modal .modal-close{position:absolute;top:20px;right:24px;background:none;border:none;color:var(--text3);cursor:pointer;font-size:20px}

/* 5. ì»¨ì„¼ì„œìŠ¤ ë°´ë“œëŠ” ì°¨íŠ¸ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ */

/* 6. ì• ë„ë¦¬ìŠ¤íŠ¸ ë­í‚¹ */
.rank-section{margin-bottom:30px}
.rank-section h2{font-size:18px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.rank-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:20px}
.rank-card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:18px;display:flex;align-items:center;gap:14px;transition:.2s;position:relative;overflow:hidden;cursor:pointer}
.rank-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.rank-num{font-size:24px;font-weight:900;width:40px;text-align:center;flex-shrink:0;color:var(--accent2)}
.rank-card .rc-info{flex:1;min-width:0}
.rank-card .rc-name{font-weight:700;font-size:14px;margin-bottom:2px}
.rank-card .rc-firm{font-size:11px;color:var(--text3)}
.rank-card .rc-right{text-align:right;flex-shrink:0}
.rank-card .rc-accuracy{font-size:20px;font-weight:900;color:var(--green)}
.rank-card .rc-reports{font-size:11px;color:var(--text3);margin-top:2px}

/* 7. ì• ë„ë¦¬ìŠ¤íŠ¸ í”„ë¡œí•„ */
.profile-section{margin-bottom:30px}
.profile-card{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--border);border-radius:20px;padding:28px;margin-bottom:20px;display:flex;gap:24px;flex-wrap:wrap;align-items:flex-start}
.profile-avatar{width:80px;height:80px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;flex-shrink:0;background:var(--accent);color:white}
.profile-info{flex:1;min-width:200px}
.profile-info h3{font-size:20px;font-weight:900;margin-bottom:4px}
.profile-info .profile-firm{color:var(--text2);font-size:14px;margin-bottom:4px}
.profile-info .profile-sector{color:var(--text3);font-size:12px;margin-bottom:16px}
.profile-stats{display:flex;gap:24px;flex-wrap:wrap}
.profile-stat{text-align:center}
.profile-stat .val{font-size:20px;font-weight:900;color:var(--accent2)}
.profile-stat .lbl{font-size:11px;color:var(--text3);margin-top:2px}
.profile-history{margin-top:20px}
.profile-history h4{font-size:14px;font-weight:700;margin-bottom:12px}
.history-chart{width:100%;height:160px;background:var(--bg3);border-radius:12px;margin-bottom:16px}
.other-stocks{display:flex;gap:8px;flex-wrap:wrap}
.stock-chip{padding:6px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:600;color:var(--text2)}

@media(max-width:768px){
  .container{padding:16px}
  #stockChart{height:300px}
  .chart-header{flex-direction:column;align-items:flex-start;gap:12px}
  .profile-card{flex-direction:column;align-items:center;text-align:center}
  .rank-grid{grid-template-columns:1fr}
}

::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
</style>
</head>
<body>

<nav class="nav">
<div class="nav-inner">
<div class="logo">ğŸ“Š ì• ë„ë¦¬ìŠ¤íŠ¸ ì°¨íŠ¸</div>
</div>
</nav>

<div class="container">
<!-- 1. ì¢…ëª© ê²€ìƒ‰ ë°” -->
<div class="search-wrap">
<input type="text" id="searchInput" placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ ê²€ìƒ‰..." value="ì‚¼ì„±ì „ì" oninput="onSearch(this.value)" onfocus="showDropdown()">
<div class="search-dropdown" id="searchDropdown">
<div class="search-item" onclick="selectStock('ì‚¼ì„±ì „ì', '005930')">
<span>ì‚¼ì„±ì „ì</span>
<span class="ticker">005930</span>
</div>
<div class="search-item" onclick="selectStock('SKí•˜ì´ë‹‰ìŠ¤', '000660')">
<span>SKí•˜ì´ë‹‰ìŠ¤</span>
<span class="ticker">000660</span>
</div>
<div class="search-item" onclick="selectStock('NAVER', '035420')">
<span>NAVER</span>
<span class="ticker">035420</span>
</div>
<div class="search-item" onclick="selectStock('ì¹´ì¹´ì˜¤', '035720')">
<span>ì¹´ì¹´ì˜¤</span>
<span class="ticker">035720</span>
</div>
</div>
</div>

<!-- 2. ì£¼ê°€ ì°¨íŠ¸ -->
<div class="chart-section">
<div class="chart-header">
<div>
<h2 id="chartTitle">ì‚¼ì„±ì „ì (005930)</h2>
<div style="display:flex;align-items:baseline;gap:8px;margin-top:4px">
<span class="price" id="chartPrice">72,500ì›</span>
<span class="change up" id="chartChange">+1,500 (+2.11%)</span>
</div>
</div>
<div style="font-size:12px;color:var(--text3)">ğŸŸ¢ë§¤ìˆ˜ ğŸ”´ë§¤ë„ ğŸŸ¡ì¤‘ë¦½ Â· í´ë¦­í•˜ë©´ ë¦¬í¬íŠ¸ ìƒì„¸</div>
</div>
<div id="stockChart" style="position:relative"></div>

<!-- 3. ë§ˆì»¤ íˆ´íŒ -->
<div class="marker-tooltip" id="markerTooltip">
<button class="close-btn" onclick="closeTooltip()">âœ•</button>
<div class="tt-header">
<div style="flex:1">
<div class="tt-analyst" id="ttAnalyst">ê¹€íˆ¬ì</div>
<div class="tt-firm" id="ttFirm">ì‚¼ì„±ì¦ê¶Œ</div>
</div>
<span class="tt-badge" id="ttBadge">ë§¤ìˆ˜</span>
</div>
<div class="tt-body">
<div class="tt-target" id="ttTarget">ëª©í‘œê°€: 85,000ì›</div>
<div class="tt-summary" id="ttSummary">ë°˜ë„ì²´ ì—…í™© íšŒë³µê³¼ ë©”ëª¨ë¦¬ ê°€ê²© ìƒìŠ¹ìœ¼ë¡œ ì‹¤ì  ê°œì„  ê¸°ëŒ€</div>
</div>
</div>

<!-- 4. ë¦¬í¬íŠ¸ ìƒì„¸ íŒì—… -->
<div class="modal-overlay" id="reportModal">
<div class="modal">
<button class="modal-close" onclick="closeReportModal()">âœ•</button>
<h3 id="modalTitle">ğŸ“„ ì• ë„ë¦¬ìŠ¤íŠ¸ ë¦¬í¬íŠ¸</h3>
<div class="report-meta">
<div class="meta-row">
<span class="meta-label">ì• ë„ë¦¬ìŠ¤íŠ¸</span>
<span class="meta-value" id="modalAnalyst">ê¹€íˆ¬ì (ì‚¼ì„±ì¦ê¶Œ)</span>
</div>
<div class="meta-row">
<span class="meta-label">ë°œí–‰ì¼</span>
<span class="meta-value" id="modalDate">2024.12.15</span>
</div>
<div class="meta-row">
<span class="meta-label">íˆ¬ìì˜ê²¬</span>
<span class="meta-value" id="modalOpinion">ë§¤ìˆ˜</span>
</div>
<div class="meta-row">
<span class="meta-label">ëª©í‘œê°€</span>
<span class="meta-value" id="modalTarget">85,000ì›</span>
</div>
</div>
<div class="report-content" id="modalContent">
ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì—…í™©ì´ ë³¸ê²©ì ì¸ íšŒë³µì„¸ì— ì§„ì…í•˜ë©°, 2025ë…„ë¶€í„°ëŠ” ìˆ˜ìµì„± ê°œì„ ì´ ê°€ì†í™”ë  ê²ƒìœ¼ë¡œ ì „ë§ë©ë‹ˆë‹¤. íŠ¹íˆ HBM ìˆ˜ìš” ì¦ê°€ì™€ ì„œë²„ìš© DRAM ê°€ê²© ìƒìŠ¹ì´ ì£¼ìš” ìˆ˜ìµ ë™ë ¥ì´ ë  ê²ƒì…ë‹ˆë‹¤.
</div>
</div>
</div>
</div>

<!-- 6. ì• ë„ë¦¬ìŠ¤íŠ¸ ë­í‚¹ -->
<div class="rank-section">
<h2>ğŸ† ì• ë„ë¦¬ìŠ¤íŠ¸ ì ì¤‘ë¥  ë­í‚¹</h2>
<div class="rank-grid" id="analystRanking">
<!-- ë­í‚¹ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
</div>
</div>

<!-- 7. ì• ë„ë¦¬ìŠ¤íŠ¸ í”„ë¡œí•„ (ì„ íƒëœ ì• ë„ë¦¬ìŠ¤íŠ¸) -->
<div class="profile-section">
<h2>ğŸ‘¤ ì• ë„ë¦¬ìŠ¤íŠ¸ í”„ë¡œí•„</h2>
<div class="profile-card" id="analystProfile">
<div class="profile-avatar">ê¹€</div>
<div class="profile-info">
<h3>ê¹€íˆ¬ì</h3>
<div class="profile-firm">ì‚¼ì„±ì¦ê¶Œ ë¦¬ì„œì¹˜ì„¼í„°</div>
<div class="profile-sector">IT/ë°˜ë„ì²´ ì „ë¬¸</div>
<div class="profile-stats">
<div class="profile-stat">
<div class="val">87.5%</div>
<div class="lbl">ì ì¤‘ë¥ </div>
</div>
<div class="profile-stat">
<div class="val">23</div>
<div class="lbl">ì´ ë¦¬í¬íŠ¸</div>
</div>
<div class="profile-stat">
<div class="val">+12.3%</div>
<div class="lbl">í‰ê· ìˆ˜ìµë¥ </div>
</div>
</div>
<div class="profile-history">
<h4>ğŸ“ˆ ëª©í‘œê°€ íˆìŠ¤í† ë¦¬</h4>
<div class="history-chart">
<canvas id="historyChart" style="width:100%;height:100%"></canvas>
</div>
<h4>ğŸ” ë‹¤ë¥¸ ë‹´ë‹¹ ì¢…ëª©</h4>
<div class="other-stocks">
<div class="stock-chip">SKí•˜ì´ë‹‰ìŠ¤</div>
<div class="stock-chip">LGë””ìŠ¤í”Œë ˆì´</div>
<div class="stock-chip">ì‚¼ì„±SDI</div>
</div>
</div>
</div>
</div>
</div>

</div>

<script>
// ê°€ìƒ ë°ì´í„°
const stockData = [
  {time: '2024-08-01', open: 71000, high: 72500, low: 70500, close: 72000},
  {time: '2024-08-05', open: 72000, high: 73000, low: 71500, close: 72500},
  {time: '2024-08-10', open: 72500, high: 74000, low: 72000, close: 73500},
  {time: '2024-08-15', open: 73500, high: 75000, low: 73000, close: 74000},
  {time: '2024-08-20', open: 74000, high: 74500, low: 72500, close: 73000},
  {time: '2024-08-25', open: 73000, high: 73500, low: 71000, close: 71500},
  {time: '2024-09-01', open: 71500, high: 72000, low: 70000, close: 70500},
  {time: '2024-09-05', open: 70500, high: 71000, low: 69000, close: 69500},
  {time: '2024-09-10', open: 69500, high: 70500, low: 68500, close: 69000},
  {time: '2024-09-15', open: 69000, high: 70000, low: 68000, close: 68500},
  {time: '2024-09-20', open: 68500, high: 69000, low: 67000, close: 67500},
  {time: '2024-09-25', open: 67500, high: 68500, low: 66500, close: 67000},
  {time: '2024-10-01', open: 67000, high: 68000, low: 65500, close: 66000},
  {time: '2024-10-05', open: 66000, high: 67000, low: 64500, close: 65000},
  {time: '2024-10-10', open: 65000, high: 66000, low: 63500, close: 64000},
  {time: '2024-10-15', open: 64000, high: 65500, low: 62500, close: 63000},
  {time: '2024-10-20', open: 63000, high: 64000, low: 61000, close: 62000},
  {time: '2024-10-25', open: 62000, high: 63500, low: 60500, close: 61500},
  {time: '2024-11-01', open: 61500, high: 63000, low: 60000, close: 62000},
  {time: '2024-11-05', open: 62000, high: 64000, low: 61000, close: 63500},
  {time: '2024-11-10', open: 63500, high: 65000, low: 62500, close: 64500},
  {time: '2024-11-15', open: 64500, high: 66500, low: 63500, close: 65500},
  {time: '2024-11-20', open: 65500, high: 67000, low: 64500, close: 66000},
  {time: '2024-11-25', open: 66000, high: 68000, low: 65000, close: 67000},
  {time: '2024-12-01', open: 67000, high: 69000, low: 66000, close: 68500},
  {time: '2024-12-05', open: 68500, high: 70500, low: 67500, close: 69500},
  {time: '2024-12-10', open: 69500, high: 71500, low: 68500, close: 70500},
  {time: '2024-12-15', open: 70500, high: 72500, low: 69500, close: 71500},
  {time: '2024-12-20', open: 71500, high: 73500, low: 70500, close: 72500}
];

// ì• ë„ë¦¬ìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ë°ì´í„°
const analystReports = [
  {date: '2024-08-15', analyst: 'ê¹€íˆ¬ì', firm: 'ì‚¼ì„±ì¦ê¶Œ', opinion: 'buy', target: 85000, summary: 'ë°˜ë„ì²´ ì—…í™© íšŒë³µìœ¼ë¡œ ì‹¤ì  ê°œì„  ê¸°ëŒ€', content: 'HBM ìˆ˜ìš” ì¦ê°€ì™€ ë©”ëª¨ë¦¬ ê°€ê²© íšŒë³µìœ¼ë¡œ ë§¤ì¶œ ì„±ì¥ ì „ë§'},
  {date: '2024-08-20', analyst: 'ë°•ë¶„ì„', firm: 'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', opinion: 'neutral', target: 75000, summary: 'ë‹¨ê¸° ì¡°ì • í›„ ìƒìŠ¹ ì¬ê°œ ì˜ˆìƒ', content: 'ì¤‘êµ­ ê²½ê¸°ë‘”í™” ìš°ë ¤ë¡œ ë‹¨ê¸° ì¡°ì • ë¶ˆê°€í”¼í•˜ë‚˜ ì¥ê¸° ì „ë§ì€ ê¸ì •ì '},
  {date: '2024-09-10', analyst: 'ì´ë¦¬ì„œì¹˜', firm: 'NHíˆ¬ìì¦ê¶Œ', opinion: 'buy', target: 80000, summary: 'AI ë°˜ë„ì²´ ìˆ˜ìš” ì¦ê°€ë¡œ ìˆ˜í˜œ', content: 'AI ì„œë²„ìš© HBM ê³µê¸‰ í™•ëŒ€ë¡œ ê³ ë§ˆì§„ ì œí’ˆ ë¹„ì¤‘ ì¦ê°€'},
  {date: '2024-09-25', analyst: 'ìµœì• ë„', firm: 'KBì¦ê¶Œ', opinion: 'sell', target: 60000, summary: 'ë©”ëª¨ë¦¬ ê°€ê²© í•˜ë½ ìš°ë ¤', content: 'ì¤‘êµ­ ìˆ˜ìš” ë‘”í™”ì™€ ê³µê¸‰ ê³¼ì‰ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê°€ê²© ì•½ì„¸ ì§€ì†'},
  {date: '2024-10-15', analyst: 'ì •ì „ë¬¸ê°€', firm: 'í•œêµ­íˆ¬ìì¦ê¶Œ', opinion: 'neutral', target: 68000, summary: 'ì‹¤ì  ë¶€ì§„ ì§€ì†, ê´€ë§ í•„ìš”', content: '3ë¶„ê¸° ì‹¤ì  ë¶€ì§„ í™•ì¸, 4ë¶„ê¸°ì—ë„ ê°œì„  ì œí•œì '},
  {date: '2024-11-05', analyst: 'í™ì—°êµ¬ì›', firm: 'ì‹ í•œíˆ¬ìì¦ê¶Œ', opinion: 'buy', target: 78000, summary: 'ì €ì  ë§¤ìˆ˜ ê¸°íšŒ ë¶€ê°', content: 'ê³¼ë„í•œ í•˜ë½ìœ¼ë¡œ ë§¤ë ¥ì ì¸ ë°¸ë¥˜ì—ì´ì…˜, ë°˜ë“± ê¸°ëŒ€'},
  {date: '2024-11-20', analyst: 'ê°•ì• ë„ë¦¬ìŠ¤íŠ¸', firm: 'ëŒ€ì‹ ì¦ê¶Œ', opinion: 'buy', target: 82000, summary: '2025ë…„ ì—…í™© íšŒë³µ ê¸°ëŒ€', content: 'ë‚´ë…„ ë©”ëª¨ë¦¬ ì‚¬ì´í´ ìƒìŠ¹ê³¼ HBM ë³¸ê²© ê¸°ì—¬ë¡œ ì‹¤ì  ê°œì„ '},
  {date: '2024-12-10', analyst: 'ìœ¤ë¦¬í¬íŠ¸', firm: 'í•˜ë‚˜ì¦ê¶Œ', opinion: 'neutral', target: 73000, summary: 'ë‹¨ê¸° ë ë¦¬ í›„ ì¡°ì • ê°€ëŠ¥ì„±', content: 'ì—°ë§ ë°˜ë“±ì€ ì œí•œì , ë‚´ë…„ 1ë¶„ê¸° ì‹¤ì  í™•ì¸ í›„ íŒë‹¨'},
  {date: '2024-12-15', analyst: 'ê¹€íˆ¬ì', firm: 'ì‚¼ì„±ì¦ê¶Œ', opinion: 'buy', target: 85000, summary: 'ëª©í‘œê°€ ìƒí–¥, ê°•ë ¥ ë§¤ìˆ˜', content: 'HBM ë§¤ì¶œ ê¸‰ì¦ê³¼ DDR5 ì „í™˜ ê°€ì†í™”ë¡œ ì‹¤ì  ì„œí”„ë¼ì´ì¦ˆ ê¸°ëŒ€'},
  {date: '2024-08-25', analyst: 'ë°•ë¶„ì„', firm: 'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', opinion: 'buy', target: 78000, summary: '2H ì‹¤ì  ê°œì„  ì „ë§', content: 'í•˜ë°˜ê¸° ë©”ëª¨ë¦¬ ê°€ê²© íšŒë³µê³¼ ëª¨ë°”ì¼ ìˆ˜ìš” ì¦ê°€'},
  {date: '2024-09-15', analyst: 'ì´ë¦¬ì„œì¹˜', firm: 'NHíˆ¬ìì¦ê¶Œ', opinion: 'neutral', target: 70000, summary: 'íˆ¬ìì˜ê²¬ í•˜í–¥ ì¡°ì •', content: 'ê¸€ë¡œë²Œ ê²½ê¸° ë‘”í™” ìš°ë ¤ë¡œ ì‹ ì¤‘í•œ ì ‘ê·¼ í•„ìš”'},
  {date: '2024-10-01', analyst: 'ìµœì• ë„', firm: 'KBì¦ê¶Œ', opinion: 'sell', target: 58000, summary: 'ëª©í‘œê°€ í•˜í–¥, ë¹„ì¤‘ ì¶•ì†Œ', content: 'ì¸ë²¤í† ë¦¬ ì¡°ì • ì¥ê¸°í™”ì™€ ìˆ˜ìš” ë¶€ì§„ ì§€ì†'},
  {date: '2024-10-25', analyst: 'ì •ì „ë¬¸ê°€', firm: 'í•œêµ­íˆ¬ìì¦ê¶Œ', opinion: 'buy', target: 72000, summary: 'ì €ì  ë§¤ìˆ˜ ê¸°íšŒ ì œê³µ', content: 'ë°¸ë¥˜ì—ì´ì…˜ ë§¤ë ¥ë„ ì¦ê°€, ì¥ê¸° ê´€ì  ë§¤ìˆ˜'},
  {date: '2024-11-15', analyst: 'í™ì—°êµ¬ì›', firm: 'ì‹ í•œíˆ¬ìì¦ê¶Œ', opinion: 'neutral', target: 75000, summary: 'íš¡ë³´ êµ¬ê°„ ì˜ˆìƒ', content: 'ë‹¹ë¶„ê°„ 65-75K êµ¬ê°„ì—ì„œ íš¡ë³´ ì „ë§'},
  {date: '2024-12-01', analyst: 'ê°•ì• ë„ë¦¬ìŠ¤íŠ¸', firm: 'ëŒ€ì‹ ì¦ê¶Œ', opinion: 'buy', target: 85000, summary: 'ì—°ë§ ë ë¦¬ ê¸°ëŒ€', content: 'ê¸°ê´€ ë¹„ì¤‘ í™•ëŒ€ì™€ ì™¸ì¸ ë§¤ìˆ˜ì„¸ë¡œ ìƒìŠ¹ ëª¨ë©˜í…€'},
  {date: '2024-12-20', analyst: 'ìœ¤ë¦¬í¬íŠ¸', firm: 'í•˜ë‚˜ì¦ê¶Œ', opinion: 'buy', target: 80000, summary: '2025ë…„ ì „ë§ ê¸ì •ì ', content: 'ë‚´ë…„ ë©”ëª¨ë¦¬ ì—…ì‚¬ì´í´ê³¼ AI ìˆ˜ìš”ë¡œ ì‹¤ì  ì„±ì¥'}
];

// ì• ë„ë¦¬ìŠ¤íŠ¸ ì •ë³´
const analysts = [
  {name: 'ê¹€íˆ¬ì', firm: 'ì‚¼ì„±ì¦ê¶Œ', accuracy: 87.5, reports: 23, avgReturn: 12.3, avatar: 'ê¹€'},
  {name: 'ê°•ì• ë„ë¦¬ìŠ¤íŠ¸', firm: 'ëŒ€ì‹ ì¦ê¶Œ', accuracy: 84.2, reports: 18, avgReturn: 10.8, avatar: 'ê°•'}, 
  {name: 'í™ì—°êµ¬ì›', firm: 'ì‹ í•œíˆ¬ìì¦ê¶Œ', accuracy: 82.1, reports: 21, avgReturn: 9.5, avatar: 'í™'},
  {name: 'ë°•ë¶„ì„', firm: 'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', accuracy: 79.3, reports: 19, avgReturn: 8.2, avatar: 'ë°•'},
  {name: 'ì´ë¦¬ì„œì¹˜', firm: 'NHíˆ¬ìì¦ê¶Œ', accuracy: 76.8, reports: 17, avgReturn: 7.1, avatar: 'ì´'},
  {name: 'ìœ¤ë¦¬í¬íŠ¸', firm: 'í•˜ë‚˜ì¦ê¶Œ', accuracy: 74.5, reports: 16, avgReturn: 6.4, avatar: 'ìœ¤'},
  {name: 'ì •ì „ë¬¸ê°€', firm: 'í•œêµ­íˆ¬ìì¦ê¶Œ', accuracy: 72.3, reports: 20, avgReturn: 5.8, avatar: 'ì •'},
  {name: 'ìµœì• ë„', firm: 'KBì¦ê¶Œ', accuracy: 68.9, reports: 15, avgReturn: 4.2, avatar: 'ìµœ'}
];

let chart;
let currentStock = 'ì‚¼ì„±ì „ì';
let markers = [];

// ì°¨íŠ¸ ì´ˆê¸°í™”
function initChart() {
  const chartContainer = document.getElementById('stockChart');
  chart = LightweightCharts.createChart(chartContainer, {
    width: chartContainer.clientWidth,
    height: 420,
    layout: {
      background: {color: '#111827'},
      textColor: '#e2e8f0',
    },
    grid: {
      vertLines: {color: '#1e293b'},
      horzLines: {color: '#1e293b'},
    },
    crosshair: {
      mode: LightweightCharts.CrosshairMode.Normal,
    },
    rightPriceScale: {
      borderColor: '#334155',
    },
    timeScale: {
      borderColor: '#334155',
      timeVisible: true,
      secondsVisible: false,
    },
  });

  // ìº”ë“¤ìŠ¤í‹± ì‹œë¦¬ì¦ˆ
  const candleSeries = chart.addCandlestickSeries({
    upColor: '#10b981',
    downColor: '#ef4444',
    borderDownColor: '#ef4444',
    borderUpColor: '#10b981',
    wickDownColor: '#ef4444',
    wickUpColor: '#10b981',
  });

  candleSeries.setData(stockData);

  // ì»¨ì„¼ì„œìŠ¤ ë°´ë“œ (ëª©í‘œê°€ ìµœê³ /ìµœì €)
  const targetPrices = analystReports.map(r => r.target);
  const maxTarget = Math.max(...targetPrices);
  const minTarget = Math.min(...targetPrices);
  
  // ë°´ë“œ ì‹œë¦¬ì¦ˆ ì¶”ê°€
  const bandSeries = chart.addAreaSeries({
    topColor: 'rgba(59, 130, 246, 0.1)',
    bottomColor: 'rgba(59, 130, 246, 0.05)',
    lineColor: 'rgba(59, 130, 246, 0.3)',
    lineWidth: 1,
  });

  const bandData = stockData.map(d => ({
    time: d.time,
    value: (maxTarget + minTarget) / 2
  }));
  
  bandSeries.setData(bandData);

  // ë§ˆì»¤ ì¶”ê°€
  addAnalystMarkers();

  // ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬
  window.addEventListener('resize', () => {
    chart.applyOptions({ width: chartContainer.clientWidth });
  });
}

// ì• ë„ë¦¬ìŠ¤íŠ¸ ë§ˆì»¤ ì¶”ê°€
function addAnalystMarkers() {
  const markersByDate = {};
  
  // ë‚ ì§œë³„ë¡œ ë§ˆì»¤ ê·¸ë£¹í™”
  analystReports.forEach(report => {
    if (!markersByDate[report.date]) {
      markersByDate[report.date] = [];
    }
    markersByDate[report.date].push(report);
  });

  // ë§ˆì»¤ ìƒì„±
  Object.keys(markersByDate).forEach(date => {
    const reports = markersByDate[date];
    const stockPrice = stockData.find(d => d.time === date);
    
    if (stockPrice) {
      createMarkerElement(date, reports, stockPrice);
    }
  });
}

function createMarkerElement(date, reports, stockPrice) {
  const container = document.getElementById('stockChart');
  const marker = document.createElement('div');
  marker.className = 'marker-dot';
  
  // ë§ˆì»¤ ìƒ‰ìƒ ê²°ì • (ì²« ë²ˆì§¸ ë¦¬í¬íŠ¸ ê¸°ì¤€)
  const mainReport = reports[0];
  if (mainReport.opinion === 'buy') {
    marker.classList.add('buy');
    marker.innerHTML = 'ğŸŸ¢';
  } else if (mainReport.opinion === 'sell') {
    marker.classList.add('sell'); 
    marker.innerHTML = 'ğŸ”´';
  } else {
    marker.classList.add('neutral');
    marker.innerHTML = 'ğŸŸ¡';
  }

  // ë³µìˆ˜ ë¦¬í¬íŠ¸ ì‹œ ìˆ«ì í‘œì‹œ
  if (reports.length > 1) {
    const badge = document.createElement('div');
    badge.className = 'marker-count';
    badge.textContent = reports.length;
    marker.appendChild(badge);
  }

  // ìœ„ì¹˜ ì„¤ì • (ì„ì‹œë¡œ ì„ì˜ ìœ„ì¹˜)
  const rect = container.getBoundingClientRect();
  const randomX = Math.random() * (rect.width - 50) + 25;
  const randomY = Math.random() * 200 + 50;
  
  marker.style.left = randomX + 'px';
  marker.style.top = randomY + 'px';

  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  marker.addEventListener('mouseenter', (e) => {
    showTooltip(e, reports[0]);
  });

  marker.addEventListener('click', (e) => {
    e.stopPropagation();
    showReportModal(reports[0]);
  });

  container.appendChild(marker);
  markers.push(marker);
}

// ê²€ìƒ‰ ê´€ë ¨
function onSearch(value) {
  const dropdown = document.getElementById('searchDropdown');
  if (value.length > 0) {
    dropdown.classList.add('show');
  }
}

function showDropdown() {
  document.getElementById('searchDropdown').classList.add('show');
}

function selectStock(name, code) {
  currentStock = name;
  document.getElementById('searchInput').value = name;
  document.getElementById('chartTitle').textContent = `${name} (${code})`;
  document.getElementById('searchDropdown').classList.remove('show');
}

// íˆ´íŒ ê´€ë ¨
function showTooltip(event, report) {
  const tooltip = document.getElementById('markerTooltip');
  const rect = event.target.getBoundingClientRect();
  
  // íˆ´íŒ ë‚´ìš© ì„¤ì •
  document.getElementById('ttAnalyst').textContent = report.analyst;
  document.getElementById('ttFirm').textContent = report.firm;
  document.getElementById('ttTarget').textContent = `ëª©í‘œê°€: ${report.target.toLocaleString()}ì›`;
  document.getElementById('ttSummary').textContent = report.summary;
  
  const badge = document.getElementById('ttBadge');
  badge.textContent = report.opinion === 'buy' ? 'ë§¤ìˆ˜' : report.opinion === 'sell' ? 'ë§¤ë„' : 'ì¤‘ë¦½';
  badge.className = `tt-badge ${report.opinion}`;

  // ìœ„ì¹˜ ì„¤ì •
  tooltip.style.left = rect.left + 'px';
  tooltip.style.top = (rect.bottom + 10) + 'px';
  tooltip.classList.add('show');

  // 3ì´ˆ í›„ ìë™ ë‹«ê¸°
  setTimeout(() => {
    tooltip.classList.remove('show');
  }, 3000);
}

function closeTooltip() {
  document.getElementById('markerTooltip').classList.remove('show');
}

// ë¦¬í¬íŠ¸ ìƒì„¸ ëª¨ë‹¬
function showReportModal(report) {
  document.getElementById('modalAnalyst').textContent = `${report.analyst} (${report.firm})`;
  document.getElementById('modalDate').textContent = report.date;
  document.getElementById('modalOpinion').textContent = report.opinion === 'buy' ? 'ë§¤ìˆ˜' : report.opinion === 'sell' ? 'ë§¤ë„' : 'ì¤‘ë¦½';
  document.getElementById('modalTarget').textContent = `${report.target.toLocaleString()}ì›`;
  document.getElementById('modalContent').textContent = report.content;
  
  document.getElementById('reportModal').classList.add('show');
}

function closeReportModal() {
  document.getElementById('reportModal').classList.remove('show');
}

// ì• ë„ë¦¬ìŠ¤íŠ¸ ë­í‚¹ ìƒì„±
function renderAnalystRanking() {
  const container = document.getElementById('analystRanking');
  const sortedAnalysts = [...analysts].sort((a, b) => b.accuracy - a.accuracy);
  
  container.innerHTML = sortedAnalysts.map((analyst, index) => `
    <div class="rank-card" onclick="selectAnalyst('${analyst.name}')">
      <div class="rank-num">${index + 1}</div>
      <div class="rc-info">
        <div class="rc-name">${analyst.name}</div>
        <div class="rc-firm">${analyst.firm}</div>
      </div>
      <div class="rc-right">
        <div class="rc-accuracy">${analyst.accuracy}%</div>
        <div class="rc-reports">${analyst.reports}ê°œ ë¦¬í¬íŠ¸</div>
      </div>
    </div>
  `).join('');
}

// ì• ë„ë¦¬ìŠ¤íŠ¸ ì„ íƒ
function selectAnalyst(name) {
  const analyst = analysts.find(a => a.name === name);
  if (analyst) {
    updateAnalystProfile(analyst);
  }
}

// ì• ë„ë¦¬ìŠ¤íŠ¸ í”„ë¡œí•„ ì—…ë°ì´íŠ¸
function updateAnalystProfile(analyst) {
  const profile = document.getElementById('analystProfile');
  profile.innerHTML = `
    <div class="profile-avatar">${analyst.avatar}</div>
    <div class="profile-info">
      <h3>${analyst.name}</h3>
      <div class="profile-firm">${analyst.firm}</div>
      <div class="profile-sector">IT/ë°˜ë„ì²´ ì „ë¬¸</div>
      <div class="profile-stats">
        <div class="profile-stat">
          <div class="val">${analyst.accuracy}%</div>
          <div class="lbl">ì ì¤‘ë¥ </div>
        </div>
        <div class="profile-stat">
          <div class="val">${analyst.reports}</div>
          <div class="lbl">ì´ ë¦¬í¬íŠ¸</div>
        </div>
        <div class="profile-stat">
          <div class="val">+${analyst.avgReturn}%</div>
          <div class="lbl">í‰ê· ìˆ˜ìµë¥ </div>
        </div>
      </div>
      <div class="profile-history">
        <h4>ğŸ“ˆ ëª©í‘œê°€ íˆìŠ¤í† ë¦¬</h4>
        <div class="history-chart">
          <canvas id="historyChart" style="width:100%;height:100%"></canvas>
        </div>
        <h4>ğŸ” ë‹¤ë¥¸ ë‹´ë‹¹ ì¢…ëª©</h4>
        <div class="other-stocks">
          <div class="stock-chip">SKí•˜ì´ë‹‰ìŠ¤</div>
          <div class="stock-chip">LGë””ìŠ¤í”Œë ˆì´</div>  
          <div class="stock-chip">ì‚¼ì„±SDI</div>
        </div>
      </div>
    </div>
  `;
  
  // ëª©í‘œê°€ íˆìŠ¤í† ë¦¬ ì°¨íŠ¸
  initHistoryChart(analyst);
}

// ëª©í‘œê°€ íˆìŠ¤í† ë¦¬ ì°¨íŠ¸ ì´ˆê¸°í™”
function initHistoryChart(analyst) {
  const canvas = document.getElementById('historyChart');
  const ctx = canvas.getContext('2d');
  
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'],
      datasets: [{
        label: 'ëª©í‘œê°€',
        data: [85000, 78000, 72000, 78000, 85000],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        x: {
          grid: {
            color: '#1e293b'
          },
          ticks: {
            color: '#94a3b8'
          }
        },
        y: {
          grid: {
            color: '#1e293b'
          },
          ticks: {
            color: '#94a3b8',
            callback: function(value) {
              return (value/1000).toFixed(0) + 'K';
            }
          }
        }
      }
    }
  });
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
document.addEventListener('click', function(e) {
  const dropdown = document.getElementById('searchDropdown');
  const searchWrap = document.querySelector('.search-wrap');
  const tooltip = document.getElementById('markerTooltip');
  const modal = document.getElementById('reportModal');
  
  if (!searchWrap.contains(e.target)) {
    dropdown.classList.remove('show');
  }
  
  if (modal.classList.contains('show') && e.target === modal) {
    closeReportModal();
  }
  
  if (!tooltip.contains(e.target) && !e.target.classList.contains('marker-dot')) {
    closeTooltip();
  }
});

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
  initChart();
  renderAnalystRanking();
  
  // ê¸°ë³¸ ì• ë„ë¦¬ìŠ¤íŠ¸ í”„ë¡œí•„ í‘œì‹œ
  updateAnalystProfile(analysts[0]);
});
</script>

</body>
</html>