# 2026-02-21

## 오전 작업 (09:00~09:45)

### 서비스 기동
- invest-engine (port 8000), http-server (port 3001), cloudflare 터널 2개 올림
- 프론트 터널: interpretation-falling-falling-facilitate.trycloudflare.com
- 백엔드 터널: permits-lamb-poem-hear.trycloudflare.com

### 병렬 작업 4개 완료
1. ✅ **노트 탭 통합** — 메모+스크랩+북마크 하나로, 폴더/태그, URL 스크랩, SNS 자동발행, 백엔드 API 연동
2. ✅ **인플루언서 탭 guru_tracker 통합** — 대시보드에 시그널 섹션, 4명 데이터, 적중률, 필터링, 백엔드 API 추가
3. ✅ **코린이 아빠 검증 파이프라인** — 28개 비디오 배치 제출 (batch_6999165cf3608190b256076bd3cea0a9), 테스트 100% 정확도
4. ✅ **프로필/뱃지 시스템** — 투자성향 7가지 필수 + 뱃지 6종 (4단계 레어리티), 백엔드 API

### 추가 완료
5. ✅ **신호 검증 리뷰 페이지** — signal-review.html, 사람이 의심 플래그 승인/거부/수정
6. ✅ **Claude Opus 3차 검증** — smtr_claude_verify.py, 의심 플래그만 Claude Opus로 재검증

### 최종 검증 파이프라인 (확정)
```
GPT-4o-mini (1차 추출) → GPT-4o (2차 검증) → Claude Opus (의심만 3차) → 사람 (최종)
```
- 월 비용 ~$2.30 예상

### AGENTS.md 업데이트
- Every Session에 PROJECT_STATUS.md 읽기 추가
- 작업 후 PROJECT_STATUS.md 업데이트 규칙 추가
- PROJECT_STATUS.md 생성 완료

### 유저 요구사항 메모 (어제)
- 프로필에 투자성향 디폴트 필수
- 프로필에 뱃지 시스템 (선택적, 뱃지상 형태)
- 투자성향 ≠ 뱃지 (별개 항목)

### 404 에러 발생
- /api/badges, /api/notes/folders 등 404 — 서브에이전트들이 백엔드 코드 추가했지만 서버 재시작 필요할 수 있음
- invest-engine 재시작하면 해결될 것

### 터널 URL 변경 이력
- 1차: interpretation-falling-falling-facilitate.trycloudflare.com (죽음)
- 2차: lamb-exploration-village-parks.trycloudflare.com (죽음)
- 3차: evaluating-canvas-textile-affect.trycloudflare.com (502)
- 4차: viruses-excellence-performed-supervision.trycloudflare.com (현재 활성, 127.0.0.1 명시)

### 🔴 터널 안정성 문제
- cloudflared가 localhost를 IPv6(::1)로 접속 시도 → http-server IPv4만 리슨 → 502
- 해결: `--url http://127.0.0.1:3001`로 IPv4 명시
- http-server도 자주 죽음 → 30분 timeout 문제
- 근본 해결 필요: 프로세스 매니저 or 유료 터널

### Claude Opus 검증 테스트
- smtr_claude_verify.py JSON 파싱 버그 수정 (regex로 JSON 추출)
- 테스트 성공: 3개 의심 시그널 → 전부 confirmed (신뢰도 0.93)

### signal-review.html 업데이트
- 4단계 파이프라인 시각화 추가 (GPT-4o-mini → GPT-4o → Claude Opus → 사람)
- Claude 의심만 필터 추가
- Claude 검증 결과 (verdict/confidence/reason) 카드에 표시
- 2차 수정: Claude 전체 검증 반영 (더 이상 "대상 아님" 없음, 모든 시그널에 3차 결과 표시)

### Claude 검증 파이프라인 변경 (유저 요청)
- 이전: 의심 플래그만 Claude 검증
- 변경: **전체 시그널 Claude 독립 검증** (2차 통과 여부 무관)
- smtr_claude_verify.py의 identify_suspicious_signals → collect_all_signals로 교체
- 비용 차이 미미 (월 $2~3 추가)

### GPT 배치 결과 완료
- batch_6999165cf3608190b256076bd3cea0a9 완료 (28/28)
- 결과 다운로드 → _verify_batch_full_result.jsonl

### Claude Opus 전체 검증 완료 (42개)
- confirmed: 22, suspicious: 1, rejected: 11, 오류: 8 (자막없음)
- 평균 신뢰도: 0.732
- 인간 검토 필요: 12개

### 코린이 아빠 전체 수집 진행중
- 채널 전체: 205개 영상 (yt-dlp 확인, 유저는 232개라고 함)
- 기존 자막: 36개, 새로 수집 필요: 169개
- 1차 서브에이전트 실패 (회원전용 오판) → 2차 재시도 중
- yt-dlp 자막 다운 정상 작동 확인 (--write-auto-sub --sub-lang ko)
- 3차 검증까지 끝내고 최종 보고 예정

### 파이프라인 변경사항
- Claude 3차: 의심만 → **전체 시그널 독립 검증**으로 변경 (유저 요청)
- GPT 2차 없는 시그널도 Claude 직접 검증하도록 수정

### 비용 추정 (영상 300개 기준)
- Whisper $16 + GPT-4o-mini $1.5 + GPT-4o $9 + Claude Opus $15 = ~$42 (5.5만원)

### 현재 터널
- 프론트: sierra-threats-salt-nutrition.trycloudflare.com (127.0.0.1:3001)
- 백엔드: exemption-spectacular-improve-javascript.trycloudflare.com (127.0.0.1:8000)
- 30분마다 서버+터널 죽는 문제 지속

### 파이프라인 0단계 추가 (유저 아이디어)
- 제목 필터: GPT-4o-mini가 영상 제목만 보고 HIGH/MEDIUM/LOW 분류
- HIGH+MEDIUM만 자막 수집 → 파이프라인 진행
- LOW(교육/가이드/토론)는 스킵
- 비용 50~70% 절감 효과

### 코린이 아빠 전체 재시작 (v3 → continue)
- 기존 데이터 전부 삭제, 백지에서 새로 시작
- 0단계 완료: 203개 중 88개 선별 (HIGH 10 + MEDIUM 78)
- 자막 61/88개 확보
- v3 서브에이전트 0단계+자막수집까지만 함
- corinpapa-continue 서브에이전트가 나머지 이어서 진행중
  - 남은 자막 27개 수집
  - GPT-4o-mini 시그널 추출
  - GPT-4o 2차 검증
  - Claude Opus 3차 검증
- 끝나면 유저에게 최종 보고 (비용/시간/결과)

### 경쟁앱 참고
- 리타민(RETAMIN) by FnGuide: 전 증권사 리포트 통합, AI 브리핑, 글로벌 뉴스
- https://play.google.com/store/apps/details?id=com.fnguide.retamin

### 📱 탭 구조 변경 (유저 확정, 상세는 나중에)
- 하단 4탭: SNS(첫화면) / 타임라인 / 인플루언서 / 노트
- 프로필 = 대시보드 = 오른쪽 상단 아이콘 (같은 화면)
  - 투자성향 + 뱃지 + 나만의 큐레이션 + 설정
- 기존 5탭 → 4탭 + 상단 프로필로 변경

### 🔥 킬러 피처 아이디어 (유저 제안)
1. **애널리스트 패널**: 증권사 애널리스트별 프로필 + 리포트 목록 + 적중률
2. **적중률 자동 추적**: 목표가 vs 실제주가 비교 → 적중률 계산
3. **차트 마커**: 주가 차트에 인플루언서 시그널 + 애널리스트 리포트 마커 표시
4. 인플루언서 패널 ←→ 애널리스트 패널 동일 구조
5. "이 사람 말 믿어도 돼?" 를 데이터로 증명

### 증권사 리포트 (유저 관심)
- 네이버 금융 리서치 (finance.naver.com/research) 크롤링으로 무료 수집 가능
- 리타민(RETAMIN)이 하는 것과 동일한 기능 구현 가능
- 유저 반응: "시발 리얼 무료여?" → 매우 관심 높음
- 추후 리포트 크롤러 개발 고려

### 애널리스트 차트 프로토타입 (13:00~13:30)
- 유저와 애널리스트 탭 차트 설계 논의
- **핵심 결론**: 인플 차트와 애널 차트는 **따로** 만들고 나중에 합치기로
- 한 차트에 두 가지 보여주면 지저분해짐
- 삼성전자 같은 종목은 수십명 애널이 다루니까 마커가 많아짐
- **마커 형태**: 작은 원 (🟢매수/🔴매도/🟡중립), 호버→정보, 클릭→목표가 점선
- **같은날 다수 리포트**: 숫자 뱃지(●3)로 묶기
- **컨센서스 밴드**: 목표가 최고/최저 범위 음영
- **적중률순 랭킹**: 해당 종목 한정 적중률
- **유저 플로우 확정**: 타임라인(정보수집) → 인플탭(시그널) → 애널탭(리포트+적중률+프로필)
- test-analyst-chart.html 프로토타입 완성 (서브에이전트)
- 유저 반응: "족같어" → 개선 필요
- 주요 기능 정리 중 (8개 기능 리스트업)

### Git 백업 정리
- 커밋 0개였음 → 초기 커밋 완료 (167파일)
- AGENTS.md에 백업 규칙 추가 (유저 요청)
- git config: user=SMTR, email=mario@smtr.dev

### 코린이 아빠 파이프라인 완료 (13:37~13:42)
- corinpapa-continue-v2 서브에이전트 완료
- **79개 영상** 처리 → **194개 시그널** 추출 (이전 42개에서 대폭 증가)
- 시그널 분포: BUY 93(48%), SELL 42(22%), HOLD 26(13%), PRICE_TARGET 25(13%), MARKET_VIEW 8(4%)
- 주요 종목: 이더리움(39), XRP(21), 비트코인(18), CC코인(14), 켄톤(13)
- 3단계 검증 전부 통과, 의심 시그널 0개
- 비용: $14.07
- 결과 파일: _extracted_signals_full.json (194개), _verify_batch_full_result.jsonl

### 애널리스트 차트 v2 시도 실패 → v3 성공 (13:42~13:46)
- v2 서브에이전트가 파일 읽기만 하고 끝남 (실패)
- v3 재시도 → 성공, guru_tracker 스타일로 통일
- lightweight-charts + 동일 CSS 변수 + rank-card + profile-card
- 커밋 완료: "애널리스트 차트 v2: guru_tracker 스타일 통일"

### 애널리스트 탭 핵심 전제 추가 (유저 제안)
- **유저는 리포트 원문 읽을 시간도 없고 문해력도 부족**
- → AI가 요약 (핵심 3줄) + 원문 링크 제공
- 인플 탭과 같은 구조: 원본(영상/PDF) → AI 추출/요약 → 원본 링크

### 애널리스트 차트 기능 확정 (유저 피드백 반영)
- **점선 표시 제거** — 지저분하다는 피드백
- **마커 클릭 → 리포트 상세 팝업**으로 변경
- guru_tracker와 동일한 UI/디자인 사용 (CSS 변수, 컴포넌트 통일)
- 인플 프로필 ≒ 애널 프로필 (같은 형태, 데이터만 다름)

### Git 관련
- HEARTBEAT.md에 git 자동백업 규칙 추가 (하트비트마다 체크)
- AGENTS.md에 git tag 마일스톤 규칙 추가
- v0.1-initial-backup 태그 생성

### signal-review.html 오프라인 수정 (13:48~13:57)
- 유저가 signal-review.html 열었더니 "Failed to fetch" 오류 (서버 꺼져있어서)
- 유저 요청: "니가 한번에 해서 보내줘, 클릭만하면 제대로 보이게"
- 194개 시그널 JSON을 HTML에 내장 (embed)
- 문제: 서브에이전트가 42개짜리 데이터로 덮어씀 → 직접 194개로 재수정
- 194개 시그널 원본: C:\Users\Mario\.openclaw\workspace\smtr_data\corinpapa1106\_extracted_signals_full.json
- 평탄화한 194개: invest-sns/smtr_data/corinpapa1106/_all_signals_194.json
- **교훈**: 서브에이전트 2개가 같은 파일 수정하면 충돌남. 한 파일에 하나만.

### Git 현재 상태 (13:57)
- 5개 커밋 완료
- 최신: "시그널 리뷰: 194개 전체 데이터 내장 (42개→194개 수정)"

### 파이프라인 규칙 변경 (14:10~14:20, 유저 확정)
1. **1영상 1종목 1시그널** — 맥락 종합해서 1개만 (뻥튀기 금지)
2. **타임스탬프 필수** — 영상 링크에 발언 시점 포함 (&t=초)
3. **Claude Opus 전체 검증** — 의심만이 아니라 전체 시그널 독립 검증
4. **Claude corrected 의견** — 오류 발견 시 "매도가 아니라 매수입니다" 등 수정 의견 제시
5. **리뷰 페이지 4단계** — 1차(GPT-mini추출) → 2차(GPT-4o검증) → 3차(Claude검증+의견) → 4차(사람)
6. GPT-4o-mini 1차 추출 유지 (비용 효율, 검증은 상위 모델이 함)

### 중복 합치기 결과 (14:20~14:30)
- claude-verify-full 서브에이전트가 합치기 완료 후 타임아웃
- **194개 → 161개**로 중복 제거 (1영상1종목1시그널)
- 결과 파일: _merged_signals.json, _merged_signals_only.json
- Claude 검증 12/161개 진행 후 중단
- pipeline-v2 서브에이전트는 시작 안 됨
- 스크립트 생성됨: merge_duplicate_signals.py, claude_verify_merged_signals.py, build_review_page.py
- git tag: pipeline-v1-before-dedup (194개 버전 복원용)

### TODO
- **Claude 검증 이어서 돌리기** (161개 중 나머지 149개)
- 타임스탬프 매핑
- 리뷰 페이지 4단계 빌드
- 코린이 아빠 시그널 프로토타입(guru_tracker) 반영
- 증권사 리포트 크롤러 개발 (유저 관심)
- 터널 안정화
