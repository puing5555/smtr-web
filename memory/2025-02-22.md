# 2025-02-22

## SMTR 리뷰 시스템 업데이트

### 핵심 결정
- **리뷰 파이프라인 확정**: Sonnet 추출 → 인간 1차 리뷰 → Opus 재검토(거부건만) → 인간 최종 승인
- **리뷰 사이트 1개로 확정**: review-server.py (port 8899) 하나만 사용
- **review-server-opus.py (8900) 폐기**: Opus 별도 추출 파이프라인 폐기
- **직원용 내부 도구**로 운영

### 완료
- 검토 필드 드롭다운 변환 (승인/수정 후 승인/거부) + ✅/❌ 자동세팅
- Opus suggestion UI (제안 적용 버튼) + buildOpus4Section 구현
- Opus 데이터 구조 호환 수정 (result.sonnet_accurate ↔ sonnet_signal_correct)
- `_opus4_analysis.json` status "complete" → "completed" 통일
- 서브에이전트가 넣은 탭 UI 제거 (Sonnet/Opus 4 탭 → 불필요)
- Git commits: 9a741f6

### 주의사항
- 서브에이전트에게 review-server.py 수정 시켰더니 탭 코드 넣어서 깨짐 → f1a8a4b로 원복 후 수동 수정
- `_opus4_analysis.json` 데이터 구조가 프롬프트 출력과 다름 (result.sonnet_accurate vs sonnet_signal_correct)
- 터널 링크 자주 죽음 — localtunnel 불안정

### 현재 구조
- **review-server.py** (port 8899): 유일한 리뷰 서버
- Opus 분석은 `claude-3-haiku-20240307` 사용 (이름과 다름)
- 데이터: `smtr_data/corinpapa1106/` — 169 시그널, 전체 승인 완료

### 본사이트 통합 완료
- 코린이 아빠 169개 시그널 → test-timeline.html 인플루언서 탭에 통합
- `corinpapaStatements` 배열 더미→실제 데이터 교체, stmtCount 29→169
- 시그널 라벨 한글화 (강력매수/매수/긍정/보유/중립/우려/매도/강력매도)
- 날짜 포맷에 년도 추가
- Git: 30bf2ee

### 서브에이전트 교훈
- review-server.py 탭 통합 작업 시켰더니 auto-backup에 의해 탭 코드가 남아서 문제 발생
- **서브에이전트 결과물은 반드시 직접 확인 후 유저에게 보내야 함**
- `_opus4_analysis.json` UTF-8 BOM 문제 → PowerShell WriteAllText가 BOM 추가함

### 유저 규칙 추가
- AGENTS.md에 "확인 후 보고 규칙" 추가: 유저에게 확인하라 하지 말고 먼저 직접 확인
